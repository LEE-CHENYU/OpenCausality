<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kspi_k2_stress_narrative</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #fff;
            color: #000;
        }
        #graph { width: 100vw; height: 100vh; }
        .node circle {
            fill: #fff;
            stroke: #000;
            stroke-width: 1.5px;
            cursor: grab;
        }
        .node circle:hover { stroke-width: 2.5px; }
        .node circle.latent { stroke-dasharray: 4, 3; }
        .node circle.id-risk { stroke: #c00; stroke-width: 2.5px; }
        .node circle.orphan { stroke: #999; stroke-dasharray: 2, 2; fill: #f8f8f8; }
        .node text {
            font-size: 9px;
            font-weight: 400;
            pointer-events: none;
            text-anchor: middle;
        }
        .link {
            fill: none;
            stroke-opacity: 0.7;
        }
        .link:hover { stroke-opacity: 1; stroke-width: 3px !important; }
        .link.null { stroke-dasharray: 4, 3; stroke-opacity: 0.4; }
        .link.critical-issue { stroke: #f59e0b; stroke-width: 3px; }
        .label-bg {
            fill: white;
            stroke: none;
        }
        .link-label {
            font-size: 9px;
            font-weight: 500;
            fill: #333;
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        .tooltip {
            position: absolute;
            background: #fff;
            border: 1px solid #000;
            padding: 12px 16px;
            font-size: 11px;
            pointer-events: none;
            opacity: 0;
            max-width: 380px;
            line-height: 1.5;
            z-index: 1000;
        }
        .tooltip.visible { opacity: 1; }
        .tooltip h3 { font-size: 12px; font-weight: 600; margin-bottom: 8px; border-bottom: 1px solid #000; padding-bottom: 6px; }
        .tooltip-row { display: flex; justify-content: space-between; margin: 3px 0; gap: 12px; }
        .tooltip-label { color: #666; white-space: nowrap; }
        .tooltip-value { font-weight: 500; font-variant-numeric: tabular-nums; text-align: right; }
        .tooltip-value.null { color: #999; }
        .tooltip-annotation { margin-top: 8px; padding-top: 8px; border-top: 1px solid #eee; color: #444; font-style: italic; }
        .tooltip-issues { margin-top: 6px; padding-top: 6px; border-top: 1px solid #eee; }
        .tooltip-issue { font-size: 10px; margin: 2px 0; }
        .tooltip-issue.critical { color: #c00; font-weight: 600; }
        .tooltip-issue.high { color: #a16207; }
        .tooltip-orphan { margin-top: 8px; padding-top: 8px; border-top: 1px solid #eee; }
        .tooltip-orphan-tag {
            display: inline-block; font-size: 9px; font-weight: 600;
            padding: 1px 5px; background: #f8f8f8; border: 1px solid #999;
            color: #666; margin-bottom: 6px;
        }
        .tooltip-orphan-section {
            padding: 4px 6px; margin-bottom: 3px; font-size: 10px; line-height: 1.5;
        }
        .tooltip-orphan-section.role { background: #f8f8f8; }
        .tooltip-orphan-section.blocker { background: #fff5f5; }
        .tooltip-orphan-section.path-forward { background: #f0f4ff; }
        .tooltip-orphan-label {
            font-weight: 600; font-size: 9px; text-transform: uppercase;
            letter-spacing: 0.3px; margin-bottom: 1px;
        }
        .tooltip-orphan-section.role .tooltip-orphan-label { color: #444; }
        .tooltip-orphan-section.blocker .tooltip-orphan-label { color: #c00; }
        .tooltip-orphan-section.path-forward .tooltip-orphan-label { color: #1e40af; }

        /* Proposal banner */
        .proposal-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 36px;
            background: #000;
            color: #fff;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 200;
            letter-spacing: 0.5px;
        }
        .banner-sub {
            font-weight: 400;
            font-size: 10px;
            color: #aaa;
        }

        .controls {
            position: fixed;
            top: 50px;
            left: 20px;
            font-size: 11px;
            background: rgba(255,255,255,0.95);
            padding: 16px;
            border: 1px solid #000;
            z-index: 100;
            max-width: 220px;
        }
        .controls h1 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .controls .subtitle { color: #666; margin-bottom: 12px; font-size: 10px; }
        .control-row { margin: 8px 0; }
        .control-row label { color: #666; margin-right: 8px; }
        .control-row select {
            border: 1px solid #000;
            background: #fff;
            padding: 4px 8px;
            font-size: 11px;
            font-family: inherit;
        }
        .legend { margin-top: 12px; padding-top: 12px; border-top: 1px solid #ddd; }
        .legend-title { font-weight: 600; font-size: 10px; margin-bottom: 6px; }
        .legend-item { display: flex; align-items: center; margin: 4px 0; font-size: 10px; }
        .legend-line { width: 20px; height: 2px; margin-right: 8px; }
        .legend-line.dashed { border-top: 2px dashed; height: 0; }
        .stats {
            position: fixed;
            bottom: 20px;
            left: 20px;
            font-size: 10px;
            color: #666;
        }
        .stats span { margin-right: 16px; }
        .stats strong { color: #000; }

        /* Pitfall sidebar */
        .pitfall-sidebar {
            position: fixed;
            top: 50px;
            right: 20px;
            width: 340px;
            max-height: calc(100vh - 70px);
            overflow-y: auto;
            background: rgba(255,255,255,0.95);
            border: 1px solid #000;
            font-size: 11px;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        .pitfall-header {
            padding: 12px 16px 8px;
            border-bottom: 1px solid #ddd;
        }
        .pitfall-header h2 { font-size: 13px; font-weight: 600; margin-bottom: 6px; }
        .pitfall-progress { margin-bottom: 4px; }
        .pitfall-progress-bar {
            width: 100%;
            height: 6px;
            border: 1px solid #000;
            background: #fff;
        }
        .pitfall-progress-fill {
            height: 100%;
            background: #000;
            transition: width 0.3s;
        }
        .pitfall-progress-label {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }
        #pitfallList {
            flex: 1;
            overflow-y: auto;
            padding: 0 16px;
        }
        .pitfall-item {
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .pitfall-item:last-child { border-bottom: none; }
        .pitfall-item:hover { background: #f8f8f8; }
        .pitfall-item.active {
            background: #f0f4ff;
        }
        .pitfall-item.resolved {
            opacity: 0.5;
        }
        .pitfall-item.resolved .pitfall-msg { text-decoration: line-through; }
        .pitfall-item-header {
            padding: 8px 0 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .pitfall-edge { font-weight: 600; font-size: 10px; }
        .pitfall-severity { font-size: 9px; font-weight: 600; padding: 1px 5px; border: 1px solid; display: inline-block; }
        .pitfall-severity.CRITICAL { background: #000; color: #fff; border-color: #000; }
        .pitfall-severity.HIGH { background: #fff; color: #000; border-color: #000; }
        .pitfall-severity.MEDIUM { background: #eee; color: #000; border-color: #ccc; }
        .pitfall-severity.LOW { background: #fff; color: #999; border-color: #ccc; }
        .pitfall-resolved-check { color: #080; font-weight: 700; font-size: 11px; display: none; }
        .pitfall-item.resolved .pitfall-resolved-check { display: inline; }
        .pitfall-msg { font-size: 10px; color: #555; margin-bottom: 4px; }
        .pitfall-empty { color: #999; font-style: italic; padding: 12px 0; }

        /* Collapsible decision panel */
        .pitfall-decision {
            display: none;
            padding: 8px 0 10px;
            border-top: 1px solid #eee;
            font-size: 10px;
            line-height: 1.6;
        }
        .pitfall-decision.open { display: block; }
        .pitfall-decision .pd-label {
            font-weight: 600;
            color: #444;
            margin-top: 6px;
            margin-bottom: 2px;
        }
        .pitfall-decision .pd-text {
            color: #555;
            margin-bottom: 4px;
        }
        .pitfall-decision .pd-guidance {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 4px 8px;
            margin-bottom: 6px;
        }
        .pitfall-decision select {
            width: 100%;
            border: 1px solid #000;
            background: #fff;
            padding: 3px 6px;
            font-size: 10px;
            font-family: inherit;
        }
        .pitfall-decision select.decided {
            background: #000;
            color: #fff;
        }
        .pitfall-decision .pd-tooltip-area {
            font-size: 9px;
            color: #666;
            min-height: 14px;
            margin-top: 2px;
            padding: 2px 4px;
            background: #fafafa;
            border: 1px solid #eee;
        }
        .pitfall-decision input[type="text"] {
            width: 100%;
            border: 1px solid #ccc;
            padding: 3px 6px;
            font-size: 10px;
            font-family: inherit;
            margin-top: 4px;
        }
        .pitfall-decision input[type="text"]:focus {
            border-color: #000;
            outline: none;
        }
        .pitfall-decision .pd-llm-guidance {
            margin-bottom: 6px;
            font-size: 10px;
            line-height: 1.6;
            color: #333;
        }
        .pitfall-decision .pd-llm-guidance-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 4px;
            font-size: 10px;
        }
        .pd-section {
            padding: 5px 8px;
            margin-bottom: 4px;
            font-size: 10px;
            line-height: 1.6;
        }
        .pd-section-label {
            font-weight: 600;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 1px;
        }
        .pd-section.finding {
            background: #f8f8f8;
        }
        .pd-section.finding .pd-section-label { color: #444; }
        .pd-section.concern {
            background: #fffbf0;
        }
        .pd-section.concern .pd-section-label { color: #7a6400; }
        .pd-section.recommendation {
            background: #f0f4ff;
        }
        .pd-section.recommendation .pd-section-label { color: #1e40af; }
        .pd-static-ref { font-size: 9px; color: #888; margin-bottom: 4px; }
        .pd-static-ref summary { cursor: pointer; font-weight: 500; }
        .pitfall-decision .pd-buttons {
            display: flex;
            gap: 6px;
            margin-top: 6px;
        }
        .pitfall-decision .pd-btn {
            border: 1px solid #000;
            background: #fff;
            padding: 3px 12px;
            font-size: 10px;
            font-family: inherit;
            cursor: pointer;
        }
        .pitfall-decision .pd-btn:hover { background: #000; color: #fff; }
        .pitfall-decision .pd-btn.pd-btn-confirm { background: #000; color: #fff; }
        .pitfall-decision .pd-btn.pd-btn-confirm:hover { background: #333; }

        /* Sidebar footer */
        .pitfall-footer {
            padding: 10px 16px;
            border-top: 1px solid #000;
        }
        .pitfall-footer label {
            font-size: 10px;
            color: #666;
            display: block;
            margin-bottom: 4px;
        }
        .pitfall-footer input[type="text"] {
            width: 100%;
            border: 1px solid #000;
            padding: 4px 8px;
            font-size: 10px;
            font-family: inherit;
            margin-bottom: 6px;
        }
        .pitfall-footer .btn-export {
            width: 100%;
            border: 1px solid #000;
            background: #000;
            color: #fff;
            padding: 5px 12px;
            font-size: 11px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
        }
        .pitfall-footer .btn-export:hover { background: #333; }

        /* Clean edge entries (no issues) */
        .pitfall-divider {
            padding: 8px 0 4px;
            font-size: 10px;
            font-weight: 600;
            color: #999;
            border-top: 1px solid #ddd;
            margin-top: 4px;
        }
        .pitfall-item.clean-edge .pitfall-rating {
            font-size: 9px;
            font-weight: 600;
            padding: 1px 5px;
            border: 1px solid #059669;
            color: #059669;
            display: inline-block;
        }
        .pitfall-item.clean-edge .pitfall-stats {
            font-size: 9px;
            color: #888;
            margin-bottom: 4px;
        }

        /* Edge highlight animation */
        @keyframes edgeFlash {
            0%, 100% { stroke-opacity: 1; }
            50% { stroke-opacity: 0.3; }
        }
        .link.highlighted {
            stroke: #2563eb !important;
            stroke-width: 4px !important;
            stroke-opacity: 1;
            animation: edgeFlash 1s ease-in-out 3;
        }
        .link.edge-resolved {
            stroke-dasharray: 6, 4;
            stroke-opacity: 0.3;
            stroke-width: 1px !important;
        }

        /* Identification badges */
        .id-badge {
            display: inline-block;
            font-size: 8px;
            font-weight: 700;
            padding: 1px 4px;
            border-radius: 2px;
            letter-spacing: 0.3px;
            margin-left: 4px;
            vertical-align: middle;
        }
        .id-badge.STRONG { background: #059669; color: #fff; }
        .id-badge.MODERATE { background: #2563eb; color: #fff; }
        .id-badge.WEAK { background: #d97706; color: #fff; }
        .id-badge.ABSENT { background: #dc2626; color: #fff; }
        .strategy-tag {
            display: inline-block;
            font-size: 8px;
            font-weight: 500;
            padding: 1px 4px;
            border: 1px solid #ccc;
            color: #555;
            margin-left: 4px;
            vertical-align: middle;
        }
        /* Provenance badges */
        .provenance-badge {
            display: inline-block;
            font-size: 8px;
            font-weight: 600;
            padding: 1px 5px;
            border-radius: 2px;
            letter-spacing: 0.3px;
            margin-left: 4px;
            vertical-align: middle;
            color: #fff;
        }
        .provenance-badge.manual { background: #6b7280; }
        .provenance-badge.paper_scout { background: #0d9488; }
        .provenance-badge.data_scout { background: #4f46e5; }
        .provenance-badge.discovery_agent { background: #ea580c; }
        /* Causal assessment section in sidebar */
        .causal-assessment {
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid #eee;
            font-size: 10px;
            line-height: 1.6;
        }
        .causal-assessment-title {
            font-weight: 600;
            color: #059669;
            margin-bottom: 4px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="proposal-banner">
        DRAFT PROPOSAL &mdash; Requires analyst review before use
        <span class="banner-sub">Resolve flagged issues or export decisions to proceed</span>
    </div>
    <svg id="graph"></svg>
    <div class="controls">
        <h1 id="dagTitle">kspi_k2_stress_narrative</h1>
        <div class="subtitle" id="dagSubtitle"></div>
        <div class="control-row">
            <label>Edge type</label>
            <select id="typeFilter">
                <option value="all">All</option>
            </select>
        </div>
        <div class="control-row">
            <label>Rating</label>
            <select id="ratingFilter">
                <option value="all">All</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
            </select>
        </div>
        <div class="control-row">
            <label><input type="checkbox" id="showNull" checked> Show null</label>
        </div>
        <div class="control-row">
            <label><input type="checkbox" id="showLabels" checked> Show labels</label>
        </div>
        <div class="legend" id="legendContainer">
            <div class="legend-title">Edge Types</div>
        </div>
    </div>
    <div class="stats">
        <span>Edges: <strong id="statEdges">0</strong></span>
        <span>Nodes: <strong id="statNodes">0</strong></span>
        <span>A: <strong id="statA">0</strong></span>
        <span>B: <strong id="statB">0</strong></span>
        <span>C: <strong id="statC">0</strong></span>
        <span>Issues: <strong id="statIssues">0</strong></span>
        <span>Identified: <strong id="statIdentified">0</strong></span>
        <span style="color:#c00">Blocked: <strong id="statBlocked">0</strong></span>
    </div>
    <div class="pitfall-sidebar" id="pitfallSidebar">
        <div class="pitfall-header">
            <h2>Open Issues</h2>
            <div class="pitfall-progress">
                <div class="pitfall-progress-bar"><div class="pitfall-progress-fill" id="pitfallProgressFill"></div></div>
                <div class="pitfall-progress-label" id="pitfallProgressLabel">0 / 0 resolved</div>
            </div>
        </div>
        <div id="pitfallList"></div>
        <div class="pitfall-footer">
            <label>Analyst ID</label>
            <input type="text" id="analystId" placeholder="Your name or initials">
            <button class="btn-export" id="exportBtn">Export Decisions</button>
        </div>
    </div>
    <div class="tooltip" id="tooltip"></div>

    <script>
// ── INJECTED DATA ────────────────────────────────────────────────────────
const NODES = [
  {
    "id": "E_import_share",
    "label": "Pre-period import share",
    "description": "Pre-period regional import intensity (static exposure).",
    "unit": "share",
    "frequency": "static",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "cor_kspi",
    "label": "KSPI cost of risk",
    "description": "Kaspi.kz cost of risk (annualized provisions / avg loans).",
    "unit": "pct",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "cpi_headline",
    "label": "Headline CPI",
    "description": "Kazakhstan headline CPI index, log level.",
    "unit": "log",
    "frequency": "monthly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "cpi_nontradable",
    "label": "Non-tradable CPI",
    "description": "CPI for non-tradable goods (services). Block A falsification.",
    "unit": "log",
    "frequency": "monthly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "cpi_tradable",
    "label": "Tradable CPI",
    "description": "CPI for tradable goods (import-weighted). Block A validated.",
    "unit": "log",
    "frequency": "monthly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "deposit_cost_kspi",
    "label": "KSPI deposit cost",
    "description": "Kaspi.kz average deposit rate.",
    "unit": "pct",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "imported_inflation_instrument",
    "label": "Imported inflation IV",
    "description": "Constructed instrument for imported inflation (FX change \u00d7 pre-period import share).",
    "unit": "pct",
    "frequency": "monthly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "k2_ratio_kspi",
    "label": "KSPI K2 capital ratio",
    "description": "Kaspi.kz K2 capital adequacy ratio (Total Capital / RWA).",
    "unit": "pct",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "kzt_usd",
    "label": "KZT/USD exchange rate",
    "description": "Kazakh tenge per US dollar, log level.",
    "unit": "log",
    "frequency": "daily",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "nominal_expenditure",
    "label": "Nominal consumption expenditure",
    "description": "Household nominal consumption expenditure. Block F validated.",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "nominal_income",
    "label": "Nominal monetary income",
    "description": "Regional household nominal monetary income. Block B validated.",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "ppop_kspi",
    "label": "KSPI pre-provision operating profit",
    "description": "Kaspi.kz PPOP (revenue - opex, before provisions).",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "real_expenditure",
    "label": "Real consumption expenditure",
    "description": "Nominal expenditure deflated by CPI. Block F validated.",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "real_income",
    "label": "Real monetary income",
    "description": "Nominal income deflated by CPI. Identity node.",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "rwa_kspi",
    "label": "KSPI risk-weighted assets",
    "description": "Kaspi.kz risk-weighted assets for regulatory capital.",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "total_capital_kspi",
    "label": "KSPI total capital",
    "description": "Kaspi.kz total regulatory capital (Tier 1 + Tier 2).",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "transfer_income",
    "label": "Transfer income",
    "description": "Household income from government transfers.",
    "unit": "log",
    "frequency": "quarterly",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  },
  {
    "id": "vix_shock",
    "label": "VIX shock",
    "description": "Innovation in VIX (risk aversion shock).",
    "unit": "innovation",
    "frequency": "daily",
    "observed": true,
    "latent": false,
    "orphan": false,
    "provenance_source": ""
  }
];
const EDGES = [
  {
    "id": "kzt_usd_to_cpi_tradable",
    "source": "kzt_usd",
    "target": "cpi_tradable",
    "edge_type": "immutable",
    "expected_sign": "positive",
    "interpretation": "Differential inflation response by import intensity",
    "notes": "Block A validated result: 11.3% FX pass-through to tradable CPI.",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 0.0001308707005012602,
    "se": 7.462327268926213e-05,
    "pvalue": 0.07947304146889873,
    "design": "LOCAL_PROJECTIONS",
    "rating": "A",
    "score": 0.97,
    "claim_level": "REDUCED_FORM",
    "all_pass": true,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": true
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Design LOCAL_PROJECTIONS provides REDUCED_FORM level only",
    "n_obs": 186,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "A depreciation of the KZT against the USD is associated with higher tradable CPI, consistent with exchange-rate pass-through raising local-currency prices of imported and import-competing goods; the reported magnitude corresponds to roughly 11.3% pass-through under the study\u2019s scaling. The main risks are omitted shocks that move both the exchange rate and tradable inflation (e.g., commodity-price or monetary-policy news), reverse timing/anticipation (prices adjusting before observed FX moves), and measurement/composition changes in the tradables basket. Next, check robustness to adding global controls (oil, global inflation, USD index), alternative lags and local-projection horizons, and whether pass-through is state-dependent (large vs small FX moves) and stable across subsamples/regimes.",
    "causal_assessment": "**Strategy**: Reduced-form local projections estimating the dynamic association between KZT/USD movements and tradable CPI, with extensive time-series robustness/diagnostic checks but no explicit exogenous shock/IV/RCT identification.\n\n**Strengths**: The LP design with HAC inference and multiple stability/sensitivity diagnostics (bandwidth, lag/HAC sensitivity, regime stability, residual autocorrelation, leads test) supports that the estimated pass-through pattern is not an artifact of serial correlation, specification choice, or unstable regimes. The \u201cshock support\u201d and \u201csign consistency\u201d checks add credibility that the measured response is systematic in the data and not driven by a narrow subset of episodes.\n\n**Vulnerabilities**: Without an identification strategy for exchange-rate innovations (e.g., external instrument, high-frequency monetary surprise, commodity-driven terms-of-trade shock, or policy discontinuity), the KZT/USD change is likely endogenous to inflation news, monetary policy reactions, risk premia, and demand/supply shocks that also affect tradable prices, violating causal interpretation. Passing time-series diagnostics does not address omitted variable bias or simultaneity; the marginal significance (p\u22480.079) further suggests the estimate may be sensitive to remaining endogeneity or sampling variation.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "kzt_usd_to_cpi_nontradable",
    "source": "kzt_usd",
    "target": "cpi_nontradable",
    "edge_type": "immutable",
    "expected_sign": "any",
    "interpretation": "Falsification test for FX pass-through",
    "notes": "Block A falsification: Near-zero pass-through to non-tradable CPI.",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 7.680517172265832e-05,
    "se": 3.3801146890145904e-05,
    "pvalue": 0.023070493914662118,
    "design": "LOCAL_PROJECTIONS",
    "rating": "A",
    "score": 0.97,
    "claim_level": "REDUCED_FORM",
    "all_pass": true,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": true
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Design LOCAL_PROJECTIONS provides REDUCED_FORM level only",
    "n_obs": 186,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:kzt_usd_to_cpi_nontradable",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0231 but claim_level=REDUCED_FORM. Significance does not establish causation."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "A depreciation of the KZT against the USD is associated with a small increase in Kazakhstan\u2019s non-tradable CPI, which is a useful falsification check because true non-tradables should exhibit near-zero exchange-rate pass-through absent broad macro spillovers. The key risk is that this reduced-form link reflects omitted aggregate forces (monetary/fiscal tightening, demand shocks, wage indexation, administered price adjustments, or measurement/classification errors where \u201cnon-tradables\u201d include imported inputs) rather than exchange-rate transmission per se, and the statistically significant but tiny estimate could still be economically negligible. Next, the researcher should check robustness to controls for domestic demand and policy (interest rates, output gap, wages, regulated tariffs), alternative definitions/weights of non-tradables, and dynamic specifications (lags, local projections) to see whether the association is stable and not driven by specific episodes (e.g., devaluation windows).",
    "causal_assessment": "**Strategy**: Reduced-form local projections estimating the dynamic response of non-tradable CPI to KZT/USD movements, relying on time-series robustness diagnostics rather than a source of exogenous variation.\n\n**Strengths**: A broad set of time-series diagnostics passes (residual autocorrelation checks, leads test, HAC sensitivity/bandwidth, lag sensitivity, regime stability, shock support), which supports internal validity of the *forecasting* relationship and reduces concerns that results are an artifact of specification, serial correlation, or unstable regimes. The estimate is statistically different from zero (p\u22480.023) but economically tiny, aligning with the stated falsification expectation (\u201cnear-zero pass-through\u201d to non-tradables).\n\n**Vulnerabilities**: There is explicitly no identification strategy (no IV, no natural experiment, no structural shock isolation), so KZT/USD is likely endogenous to domestic inflation conditions, monetary policy reactions, and common shocks (e.g., commodity prices), all of which can confound the edge. Even with leads tests and stability checks, reduced-form LPs do not rule out omitted time-varying confounders or simultaneity (exchange rate and prices co-moving due to shared drivers), so the causal interpretation is not secured.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "imported_inflation_instrument_to_real_income",
    "source": "imported_inflation_instrument",
    "target": "real_income",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Imported inflation induced by exchange-rate depreciation-&gt;Households&#x27; purchasing power (negative)",
    "provenance_source": "",
    "provenance_detail": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "Imported inflation induced by exchange-rate depreciation causes real income to fall by reducing households\u2019 purchasing power: nominal wages and transfers typically adjust sluggishly while the prices of imported consumption goods and imported inputs (passed through into domestic prices) rise. The key risk is that exchange-rate depreciations often coincide with broader macro shocks\u2014monetary tightening, capital-flow reversals, financial distress, or terms-of-trade changes\u2014that directly affect real income, violating the exclusion restriction and making the instrument reflect more than \u201cpure\u201d imported inflation; heterogeneity in pass-through and consumption baskets can also blur the mapping from the instrument to households\u2019 effective inflation. Next, the researcher should test instrument relevance (first-stage pass-through to CPI components), probe exclusion via placebo outcomes and controls for concurrent macro/financial shocks, and check robustness across groups with different import shares (e.g., high vs. low imported-consumption exposure) to see if the implied channel matches the data.",
    "causal_assessment": "**Strategy**: No explicit identification strategy is provided; the edge is asserted based on an economic narrative that exchange-rate\u2013driven imported inflation reduces households\u2019 purchasing power and thus real income.\n\n**Strengths**: The proposed direction is economically coherent (higher consumer prices mechanically reduce real purchasing power holding nominal income fixed), and the \u201cimported inflation\u201d construct plausibly targets an external price component rather than purely domestic demand-driven inflation.\n\n**Vulnerabilities**: Without a design (e.g., IV, natural experiment, or quasi-exogenous shock) this is vulnerable to endogeneity and omitted variables: exchange-rate depreciation and imported inflation can coincide with broader macro shocks (recessions, wage dynamics, policy responses) that also directly affect real income. The term \u201cinstrument\u201d suggests IV use, but no first-stage/weak-IV diagnostics, exclusion restriction argument, or falsification/placebo tests are provided, so the causal pathway is not empirically isolated.\n\n**Verdict**: **ABSENT**",
    "blocked_reason": "DataScout exhausted: no data found for node &#x27;imported_inflation_instrument&#x27; after 2 passes",
    "remediation": "Place a CSV with columns [date, imported_inflation_instrument] in data/downloaded/imported_inflation_instrument.csv, or add a source entry in the DAG YAML under nodes.imported_inflation_instrument.source."
  },
  {
    "id": "cpi_headline_to_real_income",
    "source": "cpi_headline",
    "target": "real_income",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Imported inflation (price level increase) with sticky incomes-&gt;Real disposable income (negative)",
    "provenance_source": "",
    "provenance_detail": "",
    "point": null,
    "se": null,
    "pvalue": null,
    "design": "DATA_INSUFFICIENT",
    "rating": "D",
    "score": 0.0,
    "claim_level": "DESCRIPTIVE",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample",
      "data_insufficient"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has DESCRIPTIVE",
    "n_obs": 0,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "Higher headline CPI inflation is associated with lower real income because prices rise faster than nominal wages and transfers adjust, compressing households\u2019 purchasing power, especially when imported inflation feeds through quickly to consumer baskets. The main risk is that this reduced-form relationship may be confounded by simultaneous macro shocks (e.g., recessions, exchange-rate moves, monetary tightening) that both raise measured CPI and depress incomes, as well as mechanical issues from how \u201creal income\u201d is deflated (common deflator bias) or compositional changes in the price index. A researcher should next check timing and pass-through\u2014e.g., whether CPI leads real income in an event-study or distributed-lag setup\u2014and test robustness to alternative deflators (core CPI, PCE, region-specific CPI) and controls for exchange rates, unemployment, and policy rates.",
    "causal_assessment": "**Strategy**: Local projections estimate the reduced-form dynamic association of headline CPI with subsequent real income, but no exogenous source of variation (shock/IV/RDD/RCT) is specified.\n\n**Strengths**: Passing HAC bandwidth/sensitivity and regime-stability diagnostics suggests inference is not overly sensitive to reasonable time-series HAC choices and that coefficients are not obviously driven by a single regime break. A reduced-form LP is an appropriate descriptive tool for tracing dynamics if the identifying shock were credibly exogenous.\n\n**Vulnerabilities**: With \u201cType: none,\u201d CPI movements are endogenous to macro conditions that also move real income (business cycle, monetary policy responses, demand shocks), so reverse causality and omitted-variable bias are first-order concerns; without a shock-based identification (e.g., external/imported inflation instrument, narrative shocks, high-frequency surprises), the edge is not causally pinned down. The failed **effective_obs** diagnostic further weakens credibility because small effective sample size (especially under serial correlation) can make HAC-based significance and stability checks unreliable; additionally, the reported estimate/SE of 0.0 provides no evidentiary content.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "imported_inflation_instrument_to_real_expenditure_negative",
    "source": "imported_inflation_instrument",
    "target": "real_expenditure",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Imported inflation (price level increase) with sticky incomes-&gt;Real household spending (consumption) (negative)",
    "provenance_source": "",
    "provenance_detail": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "This edge represents the idea that an exogenous rise in imported inflation raises the prices of tradable consumption goods, and with nominal incomes adjusting sluggishly, households\u2019 real purchasing power falls, leading to lower real expenditure. The main risks are that the \u201cimported inflation\u201d instrument may not be truly exogenous\u2014e.g., it could proxy for domestic demand conditions, exchange-rate movements tied to local shocks, or policy responses that independently affect consumption\u2014creating omitted-variable bias. A researcher should check instrument relevance and exogeneity by documenting the pass-through to consumer prices, showing weak/limited correlation with domestic activity and policy shocks, and running placebo/balance tests (e.g., pre-trends, effects on clearly non-tradable components) to support the exclusion restriction.",
    "causal_assessment": "**Strategy**: No identification strategy is provided; the edge asserts a negative causal effect of imported inflation on real expenditure based on narrative economic reasoning (sticky nominal incomes).\n\n**Strengths**: The sign is theoretically coherent: if nominal incomes are sticky in the short run, higher import prices raise the cost of consumption baskets and can reduce real purchasing power and real consumption. This mechanism is consistent with standard real-income/terms-of-trade channels in open-economy macro.\n\n**Vulnerabilities**: Without an exogenous source of variation in \u201cimported inflation,\u201d the relationship is highly confounded (e.g., global demand shocks, domestic monetary/fiscal responses, exchange-rate movements, and simultaneous recession dynamics can move both inflation and real spending). Reverse causality is also plausible: domestic demand conditions can affect exchange rates, pass-through, and measured import prices, and policy reactions can jointly determine inflation and consumption.\n\n**Verdict**: **ABSENT**",
    "blocked_reason": "DataScout exhausted: no data found for node &#x27;imported_inflation_instrument&#x27; after 2 passes",
    "remediation": "Place a CSV with columns [date, imported_inflation_instrument] in data/downloaded/imported_inflation_instrument.csv, or add a source entry in the DAG YAML under nodes.imported_inflation_instrument.source."
  },
  {
    "id": "transfer_income_to_nominal_income_buffering",
    "source": "transfer_income",
    "target": "nominal_income",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Transfers and regulated prices (buffers) during exchange-rate/price shock-&gt;Headline nominal income stability (positive)",
    "provenance_source": "",
    "provenance_detail": "",
    "point": null,
    "se": null,
    "pvalue": null,
    "design": "DATA_INSUFFICIENT",
    "rating": "D",
    "score": 0.0,
    "claim_level": "DESCRIPTIVE",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample",
      "data_insufficient"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has DESCRIPTIVE",
    "n_obs": 0,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "Higher transfer income is associated with higher (or more stable) nominal income, capturing the idea that government benefits, remittances, or other transfers can buffer households\u2019 cash resources when wages or self-employment earnings are hit by an exchange-rate/price shock. The main risk is that transfers are typically targeted or responsive\u2014areas/households with falling nominal incomes may receive more transfers\u2014creating reverse causality and confounding from unobserved need, eligibility rules, or local economic conditions that also affect nominal income. A researcher should check the institutional assignment mechanism and timing (e.g., pre-announced eligibility thresholds, payment lags), test for pre-trends and simultaneity, and examine heterogeneity by eligibility status or exposure to the shock to see whether the transfer\u2013income co-movement is consistent with buffering rather than targeting.",
    "causal_assessment": "**Strategy**: Reduced-form local projections relating transfer income to nominal income dynamics, but with no stated source of exogenous variation (no shock/IV/RDD/RCT), so the edge rests on time-series association with HAC-based inference and stability checks.\n\n**Strengths**: Passing HAC bandwidth/sensitivity and regime-stability diagnostics suggests the estimated relationship is not purely an artifact of a particular lag/HAC choice or a single subsample regime. \u201cSign consistency\u201d (if genuinely pre-specified and not data-mined) provides some limited robustness against overfitting.\n\n**Vulnerabilities**: With identification explicitly listed as \u201cnone,\u201d the estimate is highly vulnerable to simultaneity and omitted variables (e.g., macro shocks that jointly move transfers and nominal income; policy reacting to income declines), plus reverse causality (transfers increasing when nominal income falls). The key failed diagnostic\u2014**effective_obs**\u2014directly undermines inferential credibility (likely too few effective observations due to autocorrelation/lag structure), and the reported estimate/SE of **0.0/0.0** with p=None is a red flag for estimation/recording issues that makes any causal interpretation untenable.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "real_income_to_cor_kspi",
    "source": "real_income",
    "target": "cor_kspi",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Household purchasing-power squeeze (real income/spending softening)-&gt;Kaspi balance-sheet pressure (positive); Household squeeze / reduced purchasing power-&gt;Repayment stress (delinquencies and provisions) (positive); Deterioration in macro conditions / household squeeze (stress)-&gt;Increase in &#x27;macro provisioning&#x27; ahead of realized defaults (positive)",
    "provenance_source": "",
    "provenance_detail": "",
    "point": null,
    "se": null,
    "pvalue": null,
    "design": "DATA_INSUFFICIENT",
    "rating": "D",
    "score": 0.0,
    "claim_level": "DESCRIPTIVE",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample",
      "data_insufficient"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has DESCRIPTIVE",
    "n_obs": 0,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "Higher real income is associated with lower household repayment stress and a stronger consumer-credit environment, so it should co-move with Kaspi\u2019s credit-risk outcomes (and thus its stock return, `cor_kspi`), with the sign depending on whether `cor_kspi` is coded as \u201cstress/pressure\u201d versus \u201cperformance.\u201d The main risk is that both real income and `cor_kspi` are jointly driven by broader macro/financial conditions (policy rates, inflation shocks, commodity terms-of-trade, exchange rate moves) or that the income measure is noisy and timing-mismatched, making the reduced-form association unstable or attenuated. A researcher should verify the variable definition and sign, test lags/leads (income typically affects delinquencies/provisions with delay), and add core macro controls or fixed effects to see whether the association survives and whether it operates through credit-risk channels (NPLs, cost of risk, provisions) rather than contemporaneous market sentiment.",
    "causal_assessment": "**Strategy**: Reduced-form local projections of `cor_kspi` on innovations in `real_income`, relying on time-series dynamics/HAC inference rather than any explicit source of exogenous variation.\n\n**Strengths**: The diagnostics that did pass (HAC bandwidth choice, HAC sensitivity, regime stability, and sign consistency) suggest the time-series specification is not overly sensitive to standard inference/tuning choices and is not obviously driven by a single regime break. The hypothesized mechanism (income squeeze \u2192 repayment stress/provisions \u2192 balance-sheet pressure) is economically coherent.\n\n**Vulnerabilities**: Identification is essentially absent because the design explicitly lists \u201cType: none\u201d: real income movements are endogenous to macro/financial conditions that also directly affect Kaspi outcomes (simultaneity, omitted common shocks like monetary policy, commodity prices, FX/inflation surprises). The failed `effective_obs` diagnostic indicates insufficient effective sample size for reliable LP impulse estimates; combined with an estimate/SE reported as 0.0 and no p-value, the result is not empirically interpretable and could reflect estimation breakdown or data/standardization issues rather than a true null effect.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "vix_shock_to_deposit_cost_kspi",
    "source": "vix_shock",
    "target": "deposit_cost_kspi",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Tighter financial conditions-&gt;Kaspi funding costs (positive)",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 0.013267925068563167,
    "se": 0.034509957033544404,
    "pvalue": 0.7006326632381366,
    "design": "LOCAL_PROJECTIONS",
    "rating": "B",
    "score": 0.6111111111111112,
    "claim_level": "REDUCED_FORM",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": true
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": false
      },
      {
        "name": "ts_regime_stability",
        "passed": false
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [
      "regime_break_detected",
      "small_sample"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Counterfactual Use: BLOCKED\nReason: regime break risk\n\nEven if p<0.05, this does not establish a causal effect.",
    "n_obs": 25,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "",
    "causal_assessment": "**Strategy**: Reduced-form local projections of Kaspi deposit funding costs on a \u201cVIX shock,\u201d effectively treating innovations in VIX as an exogenous global risk-off shock with dynamic responses estimated via HAC-robust inference.\n\n**Strengths**: VIX is plausibly external to a single bank\u2019s deposit pricing in Kazakhstan and can proxy for global financial conditions, which supports a direction of influence. Several time-series diagnostics pass (HAC bandwidth/implementation, residual autocorrelation test, leads test, HAC sensitivity, and shock support), which reduces concerns about mechanical inference problems and obvious pre-trends.\n\n**Vulnerabilities**: The design lists no explicit identification strategy, so exogeneity is assumed rather than established; VIX innovations can be correlated with other concurrent global/regional shocks (commodity prices, FX/rate moves, Kazakhstan risk premium) that also affect deposit costs, creating omitted-variable bias. Two key stability checks fail (lag sensitivity and regime stability), indicating the impulse estimates are not robust to model specification and may differ across regimes; combined with an imprecise and statistically insignificant estimate (p\u22480.70), this weakens causal interpretability.\n\n**Verdict**: WEAK"
  },
  {
    "id": "vix_shock_to_ppop_kspi",
    "source": "vix_shock",
    "target": "ppop_kspi",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Tighter financial conditions-&gt;Kaspi interest margins (profit margins) (negative)",
    "provenance_source": "",
    "provenance_detail": "",
    "point": -0.026254179640865256,
    "se": 0.015522315437371705,
    "pvalue": 0.09076368696029093,
    "design": "LOCAL_PROJECTIONS",
    "rating": "B",
    "score": 0.6955555555555556,
    "claim_level": "REDUCED_FORM",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": true
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Design LOCAL_PROJECTIONS provides REDUCED_FORM level only",
    "n_obs": 15,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "",
    "causal_assessment": "**Strategy**: Reduced-form local projections estimating the dynamic response of `ppop_kspi` to a measured `vix_shock`, relying on the shock being effectively exogenous, but with no explicit identification (no IV, no narrative/external instrument, no quasi-experimental design).\n\n**Strengths**: Several time-series diagnostics passed (leads test, residual autocorrelation checks, HAC sensitivity, lag sensitivity, regime stability, and shock support), which supports that the estimated impulse response is not an artifact of a particular lag/HAC choice or obvious pre-trends. The sign consistency diagnostic and shock support suggest the series reacts in a directionally stable way and that there is variation in the shock over the sample.\n\n**Vulnerabilities**: The identification is fundamentally not established: VIX innovations can be correlated with contemporaneous global/macroeconomic news that also affects Kaspi\u2019s interest/profit margins (omitted variables/common shocks), so the reduced-form coefficient cannot be interpreted as causal without a defensible exogeneity argument. The key failure\u2014`effective_obs`\u2014raises concerns about small effective sample size (especially after lags/leads), making inference fragile; coupled with only marginal statistical significance (p \u2248 0.091), this weakens credibility and makes results sensitive to specification and finite-sample distortions.\n\n**Verdict**: ABSENT"
  },
  {
    "id": "ppop_kspi_to_total_capital_kspi",
    "source": "ppop_kspi",
    "target": "total_capital_kspi",
    "edge_type": "mechanical",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Profits and provisions dynamics-&gt;Kaspi capital headroom (capital numerator) (ambiguous)",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 67.39583115584853,
    "se": 8.209668409808977,
    "pvalue": 2.2243652090044065e-16,
    "design": "LOCAL_PROJECTIONS",
    "rating": "B",
    "score": 0.6511111111111112,
    "claim_level": "BLOCKED_ID",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": false
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has BLOCKED_ID",
    "n_obs": 15,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:ppop_kspi_to_total_capital_kspi",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0000 but claim_level=BLOCKED_ID. Significance does not establish causation."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "Higher `ppop_kspi` (pre-provision operating profit) may be related to higher `total_capital_kspi` because operating profits can be retained and added to equity, and because provisioning dynamics can flow through accounting into regulatory capital measures, mechanically lifting the capital numerator (\u201ccapital headroom\u201d). A key risk is that the link is partly definitional or timing-driven (same reporting period accounting mappings), so the estimate may reflect balance-sheet identities rather than an economic response; it can also be invalidated by simultaneous shocks (macro conditions, asset quality, risk-weight changes) that move both profits and measured capital. Next, verify the accounting/regulatory mapping (which capital components incorporate current-period earnings and provisions, and with what lags), then re-estimate using lagged `ppop_kspi` (and/or excluding current-year profit from capital) and controlling for RWA/asset growth to see whether the association persists beyond mechanical aggregation.",
    "causal_assessment": "**Strategy**: No causal identification strategy is provided; the LOCAL_PROJECTIONS estimate is an associational time-series projection that may reflect accounting linkages rather than exogenous variation.\n\n**Strengths**: The edge is labeled \u201cmechanical,\u201d which can be appropriate if `ppop_kspi` is an accounting component that directly enters the construction of `total_capital_kspi` (e.g., profits flowing into retained earnings and thus regulatory capital), making the direction plausible. The estimate is precise (p\u22482e-16) and several time-series robustness diagnostics pass (HAC bandwidth choice, residual autocorrelation checks, HAC/lag sensitivity, regime stability, shock support, sign consistency), which supports statistical stability of the projection.\n\n**Vulnerabilities**: \u201cType: none\u201d means there is no exogenous shock, IV, discontinuity, or experimental variation isolating variation in `ppop_kspi`; thus the coefficient can be driven by common shocks (macro/credit cycle), simultaneous determination, or omitted variables affecting both profits/provisions and capital management. Two key diagnostics fail\u2014**effective_obs** (suggesting small effective sample / low independent information due to persistence) and **ts_leads_test** (failed pre-trend/lead test, implying anticipatory effects or reverse causality), both of which directly undermine causal timing and invalidate a causal interpretation even if the association is stable.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "rwa_kspi_to_k2_ratio_kspi",
    "source": "rwa_kspi",
    "target": "k2_ratio_kspi",
    "edge_type": "identity",
    "expected_sign": "any",
    "interpretation": "K2 identity: Capital / RWA",
    "notes": "K2 = Total Capital / RWA. Mechanical identity.",
    "provenance_source": "",
    "provenance_detail": "",
    "point": -0.006058255436425573,
    "se": 0.002047730679385075,
    "pvalue": 0.003091185818188935,
    "design": "LOCAL_PROJECTIONS",
    "rating": "B",
    "score": 0.7155555555555556,
    "claim_level": "BLOCKED_ID",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": false
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has BLOCKED_ID",
    "n_obs": 25,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:rwa_kspi_to_k2_ratio_kspi",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0031 but claim_level=BLOCKED_ID. Significance does not establish causation."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "This edge reflects the mechanical denominator effect in the capital ratio definition: holding total capital fixed, higher risk\u2011weighted assets (RWA) mechanically lower the K2 ratio (Total Capital/RWA). The main risk is interpreting the coefficient as an economic \u201ceffect\u201d rather than an identity; additionally, simultaneity can arise because banks actively manage both capital and RWA, and measurement/definition changes in RWA can induce spurious movement in the ratio. Next, the researcher should verify the ratio is computed consistently from the same accounting sources and period, and check robustness by decomposing changes in K2 into numerator (capital) versus denominator (RWA) movements to confirm the estimate aligns with purely mechanical arithmetic.",
    "causal_assessment": "**Strategy**: No causal identification\u2014this is a mechanical/accounting relationship where changes in RWA mechanically move the capital ratio \\(K2 = \\frac{\\text{Total Capital}}{\\text{RWA}}\\) holding the numerator fixed.\n\n**Strengths**: The sign and magnitude are directionally consistent with the identity (higher RWA lowers the ratio), and the result is statistically precise with extensive time-series robustness checks (HAC bandwidth, lag/HAC sensitivity, regime stability) passing.\n\n**Vulnerabilities**: Because the edge is an identity, the regression does not isolate an exogenous \u201cshock\u201d to RWA; movements in RWA are typically jointly determined with capital management and risk-taking, and the failed leads test flags predictive dynamics/incomplete shock isolation inconsistent with a clean local-projection causal shock. Any interpretation beyond arithmetic (e.g., \u201cRWA increases cause lower capital adequacy in a behavioral sense\u201d) is invalid without an external instrument or quasi-experiment.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "real_expenditure_to_ppop_kspi",
    "source": "real_expenditure",
    "target": "ppop_kspi",
    "edge_type": "causal",
    "expected_sign": "any",
    "interpretation": "",
    "notes": "NL-extracted: Consumer spending holding up during stress-&gt;Non-bank revenues and dividends (holding company support capacity) (positive)",
    "provenance_source": "",
    "provenance_detail": "",
    "point": -0.7732869484425496,
    "se": 5.9538920948099374e-12,
    "pvalue": 0.0,
    "design": "LOCAL_PROJECTIONS",
    "rating": "C",
    "score": 0.522,
    "claim_level": "REDUCED_FORM",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_residual_autocorr",
        "passed": false
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": false
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": false
      }
    ],
    "failure_flags": [
      "small_sample"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Counterfactual Use: BLOCKED\nReason: insufficient shock episodes\n\nEven if p<0.05, this does not establish a causal effect.",
    "n_obs": 6,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:real_expenditure_to_ppop_kspi",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0000 but claim_level=REDUCED_FORM. Significance does not establish causation."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "Higher real consumer expenditure is associated with changes in ppop_kspi, consistent with the idea that resilient spending supports non-bank operating revenues and dividend capacity within holding companies. A key risk is that both spending and ppop_kspi are jointly driven by macro conditions (e.g., employment, interest rates, asset prices) or reverse channels where financial-sector profitability affects credit availability and thus spending, so the reduced-form coefficient may not isolate a spending-to-profits pathway. The extremely large-magnitude estimate with an essentially zero SE is a red flag for scaling, deterministic construction, or a mechanical link (e.g., shared deflators, trending series, or near-identity transformations). Next, verify variable definitions/units and time aggregation, check stationarity and whether the result is driven by trends or common shocks (include macro controls, time fixed effects, and lags), and run robustness with log/percent changes and alternative specifications to see if the sign and magnitude persist.",
    "causal_assessment": "**Strategy**: Local projections are used to trace the reduced-form dynamic response of `ppop_kspi` to variation in `real_expenditure`, but no exogenous shock/IV/RCT-style source of variation is specified (effectively a time-series association).\n\n**Strengths**: Passing HAC bandwidth selection and HAC sensitivity checks suggests inference is at least robust to some choices of heteroskedasticity/autocorrelation correction. Regime-stability and sign-consistency diagnostics provide limited reassurance that the estimated relationship is not purely driven by a single subsample or a sign flip across specifications.\n\n**Vulnerabilities**: With \u201cType: none\u201d for identification, the key threat is endogeneity: `real_expenditure` likely responds contemporaneously to financial-sector conditions embedded in `ppop_kspi` (reverse causality) and to common macro shocks (omitted variables), so the LP coefficient is not interpretable as causal. Multiple failed diagnostics\u2014especially residual autocorrelation, lag sensitivity, shock support, and effective observations\u2014directly undermine internal validity (mis-specified dynamics, insufficient usable variation, and unstable impulse estimates), and the implausibly tiny SE relative to the point estimate is a red flag for numerical/estimation issues or unaccounted dependence.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "kzt_usd_to_imported_inflation_instrument",
    "source": "kzt_usd",
    "target": "imported_inflation_instrument",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "Identity component: imported_inflation_iv",
    "notes": "Auto-created identity edge from imported_inflation_iv",
    "provenance_source": "",
    "provenance_detail": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "Movements in the KZT/USD exchange rate mechanically feed into the construction of the imported-inflation instrument (e.g., via the local-currency price of imported goods), so the instrument co-moves with KZT depreciation/appreciation by design. The main risk is that this \u201cidentity\u201d link embeds channels other than imported-price pass-through\u2014such as policy reactions, capital-flow shocks, or commodity-price co-movements that also move KZT/USD\u2014so the instrument may inherit endogeneity rather than isolate exogenous import-cost variation. A researcher should verify the instrument formula and weights, check how sensitive it is to exchange-rate-only variation versus foreign prices, and run balance/placebo tests to see whether KZT/USD-driven changes in the instrument also predict outcomes that should not respond to imported inflation.",
    "causal_assessment": "**Strategy**: No causal identification is being claimed; this is an identity/construct edge where `imported_inflation_instrument` is mechanically derived from `kzt_usd` (auto-created from the IV construction).\n\n**Strengths**: If the instrument variable is explicitly defined as a deterministic function of `kzt_usd` (e.g., the FX rate itself or a component used in its calculation), then the relationship is tautologically true and does not require econometric identification.\n\n**Vulnerabilities**: This edge provides zero evidence that `kzt_usd` is exogenous with respect to the downstream outcome; any endogeneity of FX (policy responses, commodity shocks, capital flows) directly carries into the constructed instrument. If the \u201cidentity\u201d mapping is not exact (e.g., additional data sources, lags, transformations, or revisions), measurement error or undocumented processing could break the supposed determinism.\n\n**Verdict**: ABSENT",
    "blocked_reason": "DataScout exhausted: no data found for node &#x27;imported_inflation_instrument&#x27; after 2 passes",
    "remediation": "Place a CSV with columns [date, imported_inflation_instrument] in data/downloaded/imported_inflation_instrument.csv, or add a source entry in the DAG YAML under nodes.imported_inflation_instrument.source."
  },
  {
    "id": "e_import_share_to_imported_inflation_instrument",
    "source": "E_import_share",
    "target": "imported_inflation_instrument",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "Identity component of imported inflation IV construction",
    "notes": "Static exposure weight in IV construction. Formula component.",
    "provenance_source": "manual",
    "provenance_detail": "",
    "strategy_type": "accounting_identity",
    "strategy_argument": "IV = diff(log(kzt_usd)) * E_import_share is a deterministic construction.",
    "strategy_key_assumption": "Pre-period import shares are fixed exposure weights.",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "Higher import share mechanically enters the construction of the imported-inflation instrument as an exposure weight, so units with larger import shares receive a larger loading on the same external price shocks. The main risk is not causal misspecification but measurement and definitional error (e.g., time-varying import shares treated as static, mismeasured trade shares, mismatched sector/country aggregation) that can induce attenuation or spurious cross-sectional variation in the instrument. Next, a researcher should verify the exact formula and units, confirm the import-share measure is predetermined relative to the outcome window, and run robustness checks to alternative base years/definitions of import share and to allowing modest time variation.",
    "causal_assessment": "**Strategy**: This edge is defined by an accounting identity: the \u201cimported_inflation_instrument\u201d is mechanically constructed as \\( \\Delta \\log(kzt\\_usd)\\times E\\_import\\_share\\), so \\(E\\_import\\_share\\) deterministically maps into the instrument.\n\n**Strengths**: Because it is a deterministic construction, there is no statistical identification problem for this mapping itself\u2014given the formula, changes in \\(E\\_import\\_share\\) translate one-for-one into the computed instrument holding the exchange-rate term fixed. Using *pre-period* import shares can reduce simultaneity with contemporaneous shocks (i.e., avoids using endogenous current shares).\n\n**Vulnerabilities**: This is not a causal relationship in the econometric sense; it\u2019s a definition, so it does not provide exogenous variation or a testable exclusion restriction relevant for downstream causal claims. If \u201cpre-period\u201d shares are not truly predetermined (e.g., influenced by anticipatory behavior, policy, or earlier trends correlated with outcomes), then even the intended interpretation of the instrument as exogenous \u201cexposure\u201d can be compromised in subsequent stages.\n\n**Verdict**: **ABSENT**",
    "blocked_reason": "DataScout exhausted: no data found for node &#x27;E_import_share&#x27; after 2 passes",
    "remediation": "Place a CSV with columns [date, E_import_share] in data/downloaded/E_import_share.csv, or add a source entry in the DAG YAML under nodes.E_import_share.source."
  },
  {
    "id": "total_capital_kspi_to_k2_ratio_kspi",
    "source": "total_capital_kspi",
    "target": "k2_ratio_kspi",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "K2 identity: Capital / RWA",
    "notes": "K2 = Total Capital / RWA. Mechanical identity.",
    "provenance_source": "manual",
    "provenance_detail": "",
    "strategy_type": "accounting_identity",
    "strategy_argument": "K2 = Total Capital / RWA is a regulatory definition.",
    "strategy_key_assumption": "Regulatory definition is stable over the sample period.",
    "point": -0.0052503463073632455,
    "se": 0.015707329872756776,
    "pvalue": 0.7381826882754184,
    "design": "LOCAL_PROJECTIONS",
    "rating": "C",
    "score": 0.5666666666666667,
    "claim_level": "BLOCKED_ID",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": false
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": false
      },
      {
        "name": "ts_regime_stability",
        "passed": false
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [
      "regime_break_detected",
      "small_sample"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has BLOCKED_ID",
    "n_obs": 25,
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "This edge represents a mechanical accounting link: the K2 (capital adequacy) ratio is defined as total capital divided by risk\u2011weighted assets, so increases in total capital should translate into a higher K2 ratio holding RWA fixed. The main risk to interpretation is that the ratio\u2019s denominator (RWA) may change simultaneously with capital (e.g., balance-sheet expansion, risk reclassification, regulatory adjustments), so a regression of the ratio on total capital can look weak or even misleading despite the identity. A researcher should verify the exact construction and timing/units of both series and explicitly account for RWA (e.g., include RWA as a control or model the identity directly) to ensure the estimate is not being driven by denominator movements, scaling, or measurement error.",
    "causal_assessment": "**Strategy**: Uses an accounting/regulatory identity (K2 ratio is defined as Total Capital divided by RWA), treating the edge as mechanically implied rather than causally estimated.\n\n**Strengths**: The mapping from Total Capital to the K2 ratio is structurally grounded in the Basel/regulatory definition, so directionality is not a behavioral causal claim but a definitional relationship. Several time-series diagnostics (HAC bandwidth/robustness, effective observations, residual autocorrelation checks, shock support) suggest the LP implementation is not obviously driven by basic inference artifacts.\n\n**Vulnerabilities**: The empirical LP estimate is essentially null and very imprecise (\u22120.0053, SE 0.0157, p=0.74), which is inconsistent with a stable mechanical relationship unless RWA moves endogenously in ways that offset capital changes; that means the \u201ceffect\u201d of capital on the ratio is not identified without modeling/conditioning on RWA. Diagnostics failing on leads, lag sensitivity, and regime stability directly undermine the key assumption that the definitional mapping is stable over time and that the dynamic specification is correctly capturing the identity (suggesting structural breaks, changing measurement, or shifting regulatory/reporting regimes).\n\n**Verdict**: WEAK"
  },
  {
    "id": "nominal_expenditure_to_real_expenditure",
    "source": "nominal_expenditure",
    "target": "real_expenditure",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "Identity component of real expenditure deflation",
    "notes": "Nominal-to-real deflation identity. Formula component.",
    "provenance_source": "manual",
    "provenance_detail": "",
    "strategy_type": "accounting_identity",
    "strategy_argument": "real_expenditure = log(nominal_expenditure) - log(cpi_headline) is a deflation identity.",
    "strategy_key_assumption": "CPI is the appropriate deflator for household consumption.",
    "point": null,
    "se": null,
    "pvalue": null,
    "design": "DATA_INSUFFICIENT",
    "rating": "D",
    "score": 0.0,
    "claim_level": "DESCRIPTIVE",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample",
      "data_insufficient"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has DESCRIPTIVE",
    "n_obs": 0,
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "This edge captures the accounting/measurement link between nominal expenditure and real expenditure: real expenditure is constructed by deflating nominal spending by a price index, so changes in nominal spending mechanically map into changes in the real series holding the deflator fixed. The main risk is not omitted-variable bias but mismeasurement and definition drift\u2014e.g., using an inappropriate deflator, changes in the basket/quality adjustment, rebasing, or mixing nominal and real components\u2014which can create spurious co-movement or attenuate relationships. A researcher should verify the exact deflation formula, deflator source/timing (CPI vs PCE, chain-weighting, base year), and ensure consistent units and frequency alignment; also check robustness to alternative deflators and to using log differences rather than levels if trends dominate.",
    "causal_assessment": "**Strategy**: Treat the edge as an accounting/measurement identity: real_expenditure is mechanically constructed from nominal_expenditure (deflated by CPI), so the mapping is definitional rather than estimated causal variation.\n\n**Strengths**: Because real_expenditure is computed directly from nominal_expenditure (and CPI), there is no confounding in the usual sense\u2014changes in nominal_expenditure translate one-for-one into changes in the constructed real measure holding the deflator fixed. The \u201cestimate 0.0 (SE 0.0)\u201d is consistent with this being a formula component rather than an econometric relationship, and standard LP diagnostics (HAC bandwidth, stability/sensitivity checks) are largely irrelevant to identification of a definitional link.\n\n**Vulnerabilities**: The key threat is mismeasurement/construct validity: CPI_headline may be an inappropriate deflator for household consumption (substitution bias, quality adjustment, household-specific inflation, mismatch with the consumption basket), which would make \u201creal_expenditure\u201d a noisy or biased proxy for true real consumption. The failed **effective_obs** diagnostic raises concerns about whether the time-series setup has enough usable variation/observations for the LP machinery, but more importantly it underscores that statistical inference here doesn\u2019t meaningfully validate the identity.\n\n**Verdict**: MODERATE"
  },
  {
    "id": "cpi_headline_to_real_expenditure",
    "source": "cpi_headline",
    "target": "real_expenditure",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "Identity component: real_expenditure_identity",
    "notes": "Auto-created identity edge from real_expenditure_identity",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 0.8689514450133883,
    "se": 1.8932045762536065,
    "pvalue": 0.6462453388638387,
    "design": "LOCAL_PROJECTIONS",
    "rating": "B",
    "score": 0.7291111111111112,
    "claim_level": "REDUCED_FORM",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": true
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": false
      },
      {
        "name": "ts_regime_stability",
        "passed": false
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [
      "regime_break_detected"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Counterfactual Use: BLOCKED\nReason: regime break risk\n\nEven if p<0.05, this does not establish a causal effect.",
    "n_obs": 54,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false,
    "llm_annotation": "Higher headline CPI inflation is associated with lower measured real expenditure because real spending is typically constructed by deflating nominal expenditure with a price index; mechanically, a higher deflator reduces the real (quantity) measure holding nominal spending fixed. The main risk is that the reduced-form estimate is dominated by this accounting identity and by measurement/seasonal adjustment mismatches (e.g., CPI not matching the relevant consumption deflator, base-year changes, timing differences), so the coefficient may not reflect behavioral responses in consumption at all. Next, the researcher should verify the exact deflation formula and deflator used in constructing `real_expenditure`, check units/log transformations and alignment of inflation vs price level, and consider re-estimating using nominal expenditure with CPI separately (or using the appropriate PCE/consumption deflator) to separate mechanical from economic relationships.",
    "causal_assessment": "**Strategy**: No causal identification\u2014this is an auto-created \u201cidentity\u201d edge estimated via reduced-form local projections without an exogenous shock, instrument, or experimental variation.\n\n**Strengths**: The time-series diagnostics that passed (HAC bandwidth/effective obs, leads test, residual autocorrelation checks, HAC sensitivity, and shock support) support that the LP is mechanically implementable and not obviously driven by simple serial-correlation artifacts. As an \u201cidentity\u201d relation, a contemporaneous link could be conceptually grounded if real expenditure is constructed using CPI (deflation), but that would be a definitional mapping rather than an estimated causal effect.\n\n**Vulnerabilities**: With \u201cType: none\u201d and no identifying assumption, the LP coefficient is purely associational and vulnerable to simultaneity (expenditure can affect prices), omitted variables (aggregate demand/supply shocks moving both), and policy responses. Two key robustness checks fail\u2014lag sensitivity and regime stability\u2014indicating the estimate is not stable to specification/period changes; combined with an imprecise, insignificant estimate (0.87 with SE 1.89, p=0.65), this undermines any causal interpretation.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "nominal_income_to_real_income",
    "source": "nominal_income",
    "target": "real_income",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "Identity component: real_income_identity",
    "notes": "Auto-created identity edge from real_income_identity",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 0.9330544195797443,
    "se": 0.02770422400969326,
    "pvalue": 1.1680567298440232e-248,
    "design": "LOCAL_PROJECTIONS",
    "rating": "A",
    "score": 0.8375555555555555,
    "claim_level": "BLOCKED_ID",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": false
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has BLOCKED_ID",
    "n_obs": 56,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:nominal_income_to_real_income",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0000 but claim_level=BLOCKED_ID. Significance does not establish causation."
      },
      {
        "issue_key": "RATING_DIAGNOSTICS_CONFLICT:nominal_income_to_real_income",
        "rule_id": "RATING_DIAGNOSTICS_CONFLICT",
        "severity": "HIGH",
        "message": "A-rating despite failed diagnostics."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "This identity edge represents the mechanical accounting link between nominal income and real income: real income is nominal income adjusted by the price level/deflator, so changes in nominal income map into changes in purchasing power one-for-one up to inflation. The main risk to interpreting the estimate is not omitted variables but mismatch and measurement error\u2014e.g., using different deflators across units/time, base-year rebasing, or compositional changes that make the \u201creal\u201d adjustment non-comparable\u2014which can make the empirical coefficient deviate from its implied identity. Next, the researcher should verify the exact deflation formula and units (levels vs logs), confirm the deflator corresponds to the same population and period as nominal income, and check whether the near-but-not-equal-to-1 estimate is explained by inflation variation, timing differences, or data revisions.",
    "causal_assessment": "**Strategy**: This edge is an accounting/definitional identity (real income is mechanically derived from nominal income and a price deflator), not a causally identified effect using exogenous variation.\n\n**Strengths**: As an identity, the direction and sign are structurally implied by the construction of the variables, and the estimate is extremely precise (SE \u2248 0.028, p \u2248 0). Many time-series diagnostics (HAC bandwidth adequacy, effective observations, residual autocorrelation checks, HAC/lag sensitivity, regime stability, and shock support) suggest the local-projection fit is statistically stable.\n\n**Vulnerabilities**: There is no identification design (no experiment/quasi-experiment/IV), so the coefficient cannot be interpreted as a causal response of \u201creal income\u201d to an exogenous change in \u201cnominal income\u201d holding the deflator fixed\u2014real income is jointly determined by nominal income and prices. The failed **ts_leads_test** indicates evidence consistent with anticipation/reverse timing (future nominal income predicting current real income), which is a red flag for interpreting the LP estimate as a causal impulse response even if one were attempted.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "cor_kspi_to_total_capital_kspi",
    "source": "cor_kspi",
    "target": "total_capital_kspi",
    "edge_type": "mechanical",
    "expected_sign": "negative",
    "interpretation": "Capital impact from provisioning",
    "notes": "Provisioning reduces capital. Control for PPOP.",
    "provenance_source": "manual",
    "provenance_detail": "",
    "strategy_type": "accounting_identity",
    "strategy_argument": "Provisions directly reduce retained earnings and thus regulatory capital.",
    "strategy_key_assumption": "IFRS accounting rules mechanically link provisions to capital.",
    "point": -8.279877170645383,
    "se": 0.9271160839206617,
    "pvalue": 4.229850937660592e-19,
    "design": "LOCAL_PROJECTIONS",
    "rating": "B",
    "score": 0.7155555555555556,
    "claim_level": "BLOCKED_ID",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": false
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has BLOCKED_ID",
    "n_obs": 25,
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:cor_kspi_to_total_capital_kspi",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0000 but claim_level=BLOCKED_ID. Significance does not establish causation."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "",
    "causal_assessment": ""
  },
  {
    "id": "cpi_nontradable_to_cpi_headline",
    "source": "cpi_nontradable",
    "target": "cpi_headline",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "Aggregation/measurement bridge: cpi_nontradable feeds cpi_headline",
    "notes": "Auto-bridged: cpi_nontradable was unreachable from target. Connected to cpi_headline by tag similarity (shared: [&#x27;inflation&#x27;, &#x27;prices&#x27;]).",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 0.722095626287286,
    "se": 0.22687975273453517,
    "pvalue": 0.0014589663178228855,
    "design": "LOCAL_PROJECTIONS",
    "rating": "A",
    "score": 0.9255555555555555,
    "claim_level": "BLOCKED_ID",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": false
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has BLOCKED_ID",
    "n_obs": 176,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:cpi_nontradable_to_cpi_headline",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0015 but claim_level=BLOCKED_ID. Significance does not establish causation."
      },
      {
        "issue_key": "RATING_DIAGNOSTICS_CONFLICT:cpi_nontradable_to_cpi_headline",
        "rule_id": "RATING_DIAGNOSTICS_CONFLICT",
        "severity": "HIGH",
        "message": "A-rating despite failed diagnostics."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "",
    "causal_assessment": "**Strategy**: None\u2014this edge is treated as an \u201cidentity\u201d link and is empirically proxied with a local-projections association that was auto-bridged via tag similarity rather than a defined shock/IV/RCT.\n\n**Strengths**: As a matter of accounting, headline CPI is mechanically a weighted aggregation of subcomponents (tradable/non-tradable), so a positive relationship is structurally expected; the estimate is statistically significant and several time-series robustness checks (HAC sensitivity, lag sensitivity, regime stability, residual autocorrelation) reportedly pass.\n\n**Vulnerabilities**: The identification is not causal: local projections here do not isolate exogenous variation in non-tradable CPI, and the \u201cauto-bridged\u201d construction indicates the variables were linked by semantic similarity rather than a verified measurement identity (i.e., confirmed CPI weights and formula). The failed **ts_leads_test** is a red flag for reverse timing/anticipation (headline moving before \u201cnon-tradable\u201d in the LP), inconsistent with a clean causal ordering and suggestive of simultaneity/common shocks or measurement/aggregation issues.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "cpi_tradable_to_cpi_headline",
    "source": "cpi_tradable",
    "target": "cpi_headline",
    "edge_type": "identity",
    "expected_sign": "",
    "interpretation": "Aggregation/measurement bridge: cpi_tradable feeds cpi_headline",
    "notes": "Auto-bridged: cpi_tradable was unreachable from target. Connected to cpi_headline by tag similarity (shared: [&#x27;inflation&#x27;, &#x27;prices&#x27;]).",
    "provenance_source": "",
    "provenance_detail": "",
    "point": 0.761814289462254,
    "se": 0.043327155866326385,
    "pvalue": 3.334696254595197e-69,
    "design": "LOCAL_PROJECTIONS",
    "rating": "A",
    "score": 0.9255555555555555,
    "claim_level": "BLOCKED_ID",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": true
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_leads_test",
        "passed": false
      },
      {
        "name": "ts_residual_autocorr",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_lag_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      },
      {
        "name": "ts_shock_support",
        "passed": true
      }
    ],
    "failure_flags": [],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has BLOCKED_ID",
    "n_obs": 176,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [
      {
        "issue_key": "SIGNIFICANT_BUT_NOT_IDENTIFIED:cpi_tradable_to_cpi_headline",
        "rule_id": "SIGNIFICANT_BUT_NOT_IDENTIFIED",
        "severity": "CRITICAL",
        "message": "p=0.0000 but claim_level=BLOCKED_ID. Significance does not establish causation."
      },
      {
        "issue_key": "RATING_DIAGNOSTICS_CONFLICT:cpi_tradable_to_cpi_headline",
        "rule_id": "RATING_DIAGNOSTICS_CONFLICT",
        "severity": "HIGH",
        "message": "A-rating despite failed diagnostics."
      }
    ],
    "has_critical_issue": true,
    "llm_annotation": "This edge represents the mechanical aggregation channel: inflation in tradable goods is a component of the overall consumer price index, so movements in tradable CPI typically feed into headline CPI through expenditure weights and index construction. The main risk is that treating this as an estimable \u201ceffect\u201d is misleading because the relationship is partly definitional and can be distorted by reweighting, base-year changes, and differences in seasonal adjustment or coverage between the series; the auto-bridging note also flags a substantive mismatch risk if the two CPI measures are not constructed consistently. Next, the researcher should verify the CPI formula and weights (and whether tradables are a strict subset of headline), align vintages/seasonal-adjustment/base periods, and check whether the coefficient roughly matches the implied average weight of tradables in the headline basket over the sample (including allowing for time-varying weights).",
    "causal_assessment": "**Strategy**: None\u2014this edge is auto-bridged via tag similarity and then estimated with local projections, so it amounts to a predictive association rather than an identified causal effect (despite being labeled \u201cidentity\u201d).\n\n**Strengths**: The LP estimate is very precise (0.762, SE 0.043, extremely small p-value) and many time-series robustness checks pass (HAC bandwidth/effective obs, residual autocorrelation check, HAC/lag sensitivity, regime stability, shock support, sign consistency), suggesting the relationship is stable and not an artifact of a particular specification.\n\n**Vulnerabilities**: There is no source of exogenous variation and no stated identifying assumption; headline CPI mechanically co-moves with tradable CPI through index construction and shared shocks, so the coefficient is not interpretable as a causal effect without a structural decomposition/weighting identity. The failed **ts_leads_test** is a red flag for reverse timing/anticipation (headline moving before tradables), which directly undermines a causal \u201ctradables \u2192 headline\u201d interpretation even in a reduced-form sense.\n\n**Verdict**: **ABSENT**"
  },
  {
    "id": "real_income_to_real_expenditure",
    "source": "real_income",
    "target": "real_expenditure",
    "edge_type": "causal",
    "expected_sign": "",
    "interpretation": "",
    "notes": "When real income falls, households cut consumption expenditure",
    "provenance_source": "",
    "provenance_detail": "",
    "point": null,
    "se": null,
    "pvalue": null,
    "design": "DATA_INSUFFICIENT",
    "rating": "D",
    "score": 0.0,
    "claim_level": "DESCRIPTIVE",
    "all_pass": false,
    "diagnostics": [
      {
        "name": "hac_bandwidth",
        "passed": true
      },
      {
        "name": "effective_obs",
        "passed": false
      },
      {
        "name": "sign_consistency",
        "passed": true
      },
      {
        "name": "ts_hac_sensitivity",
        "passed": true
      },
      {
        "name": "ts_regime_stability",
        "passed": true
      }
    ],
    "failure_flags": [
      "small_sample",
      "data_insufficient"
    ],
    "id_risks": {
      "unmeasured_confounding": "medium",
      "simultaneity": "low",
      "weak_variation": "low",
      "measurement_error": "low",
      "selection": "low"
    },
    "cf_shock_allowed": false,
    "cf_policy_allowed": false,
    "cf_reason_blocked": "Shock CF requires REDUCED_FORM+, edge has DESCRIPTIVE",
    "n_obs": 0,
    "strategy_type": "",
    "strategy_argument": "",
    "strategy_key_assumption": "",
    "issues": [],
    "has_critical_issue": false
  }
];
const LATENTS = [];
const METADATA = {
  "name": "kspi_k2_stress_narrative",
  "description": "DAG generated from narrative text, based on kspi_k2_stress. Contains 12 edges (3 matched, 9 new).",
  "target_node": "k2_ratio_kspi",
  "created": "2026-02-08",
  "owner": "narrative_pipeline",
  "tags": [
    "narrative",
    "auto-generated"
  ]
};
const EDGE_TYPE_COLORS = {"causal": "#2563eb", "reaction_function": "#059669", "bridge": "#9333ea", "identity": "#9333ea", "mechanical": "#9333ea", "immutable": "#d97706"};
const EDGE_TYPE_LABELS = {"causal": "Causal", "reaction_function": "Reaction Function", "bridge": "Accounting Bridge", "identity": "Identity", "mechanical": "Mechanical", "immutable": "Immutable (Validated)"};
const RULE_DESCRIPTIONS = {
  "ENTITY_BOUNDARY_DRIFT": {
    "description": "Mixing entity scopes (bank vs group) breaks comparability",
    "explanation": "When different observations mix entity scopes (e.g., bank-level vs consolidated group-level), the treatment and outcome variables become incomparable across units. Capital ratios at bank level differ systematically from group level due to intra-group transfers and double counting. Ignoring this produces biased panel estimates because the variation being exploited is partly definitional, not economic.\n",
    "guidance": "Harmonize all observations to the same scope (preferably unconsolidated bank-level for Kazakhstan data). If harmonization is impossible, add a scope dummy and note the caveat in the report.\n"
  },
  "KPI_DEFINITION_MISMATCH_CROSS_BANK": {
    "description": "NPL/CoR definitions differ across banks causing sign conflicts",
    "explanation": "Banks may use different definitions for key performance indicators (e.g., NPL includes/excludes restructured loans, CoR uses different provisioning rules). Cross-bank panel estimation treats these as comparable, but definitional differences create measurement error correlated with bank characteristics. This can flip coefficient signs between runs and invalidate pooled estimates.\n",
    "guidance": "Check if the definition mismatch is economically meaningful. If yes, harmonize definitions or estimate separately by definition group. Document any remaining heterogeneity as a limitation.\n"
  },
  "SHOCK_CONSTRUCT_AMBIGUOUS": {
    "description": "EdgeCard must include shock_node_id, shock_unit, shock_scale",
    "explanation": "Without explicit shock metadata (which node is shocked, in what units, at what scale), counterfactual scenarios become ambiguous. A &quot;10% depreciation&quot; could mean 10 percentage points or 10% of the current level, leading to order-of-magnitude errors in propagation. This metadata is required for reproducible counterfactuals.\n",
    "guidance": "The system will auto-populate shock metadata from the DAG spec. Verify that the inferred shock_unit and shock_scale match your intended scenario.\n"
  },
  "FREQUENCY_ALIGNMENT_ERROR": {
    "description": "Mixing frequencies without explicit aggregation rule",
    "explanation": "Mixing monthly treatment with quarterly outcome (or vice versa) without a declared aggregation method (end-of-period, average, sum) introduces temporal misalignment. The estimator may silently interpolate or drop observations, changing the effective sample and potentially biasing results. This is auto-fixable but must be logged.\n",
    "guidance": "The system will apply the aggregation rule from the DAG spec. If no rule is specified, it defaults to end-of-period for stocks and average for flows.\n"
  },
  "FREQUENCY_SCALING_MISMATCH": {
    "description": "Annual vs quarterly estimates not normalized to common unit",
    "explanation": "When comparing estimates across runs with different frequencies, a quarterly coefficient is not directly comparable to an annual one. Failing to normalize (e.g., annualize quarterly or quarterly-ize annual) leads to incorrect propagation multipliers and misleading cross-run convergence assessments.\n",
    "guidance": "Normalize all estimates to a common time unit before comparison. The preferred convention is quarterly for macro variables and annual for structural parameters.\n"
  },
  "EXTRACTION_PROVENANCE_GAPS": {
    "description": "Missing source document/page reference for extracted data",
    "explanation": "Data extracted from PDFs, reports, or regulatory filings should carry provenance (source document, page, table number) so that results can be independently verified. Missing provenance makes reproduction impossible and raises audit risk, especially for regulatory submissions.\n",
    "guidance": "Add the source reference to the data extraction metadata. For low-risk variables (e.g., public market data), this can be accepted with a note.\n"
  },
  "REACTION_FUNCTION_EDGE": {
    "description": "Policy reaction edge cannot be used for shock propagation",
    "explanation": "A policy reaction function (e.g., central bank raises rates in response to inflation) captures endogenous behavior, not a causal effect of an exogenous shock. Using it for shock propagation would double-count the policy response or create circular logic. The edge should be classified as diagnostic or informational only.\n",
    "guidance": "Reclassify as diagnostic-only if this is purely a reaction function. If you believe there is an exogenous component, document the identification strategy and accept with a caveat.\n"
  },
  "TIME_FE_ABSORBS_SHOCK": {
    "description": "Panel with time FE and common shock requires Exposure x Shock",
    "explanation": "Time fixed effects absorb all common time-varying shocks (including the treatment of interest if it is a macro shock common to all units). To identify the effect, the design must exploit cross-sectional variation in exposure (Exposure x Shock interaction). Without this, the coefficient is mechanically zero or identified only from noise.\n",
    "guidance": "The system will suggest adding an Exposure x Shock interaction term. This is the standard diff-in-diff approach for common shocks in panel data.\n"
  },
  "EXPOSURE_NOT_PREDETERMINED": {
    "description": "Exposure variable must be measured strictly pre-treatment",
    "explanation": "If the exposure variable (e.g., bank&#x27;s FX share) is measured contemporaneously with or after the shock, it may itself be affected by the shock, creating a &quot;bad controls&quot; problem. This violates the exclusion restriction in diff-in-diff designs and biases the estimated causal effect, typically attenuating it toward zero.\n",
    "guidance": "Lag the exposure variable to a pre-treatment period. If pre-treatment measurement is unavailable, accept with a caveat noting potential attenuation bias.\n"
  },
  "MECHANICAL_EDGE_ESTIMATED": {
    "description": "Accounting identity should be bridge, not regression",
    "explanation": "Regressing an identity (e.g., CAR = Capital / RWA) produces tautological results with near-perfect fit, inflating credibility scores and wasting estimation budget. Mechanical edges should be treated as deterministic bridges that pass through shocks via calculus (partial derivatives), not statistical estimation.\n",
    "guidance": "The system will convert this to a bridge edge with deterministic sensitivity. Accept as regression only if you need to test whether the identity holds empirically.\n"
  },
  "PATH_DOUBLE_COUNTING": {
    "description": "Direct reduced-form + indirect chain both used for propagation",
    "explanation": "If both a direct reduced-form edge (A -&gt; C) and a structural chain (A -&gt; B -&gt; C) are included in propagation, the total effect is double-counted. This inflates counterfactual predictions, potentially by 100% or more. The system detects overlapping paths and requires the analyst to choose one.\n",
    "guidance": "Prefer the structural chain if all intermediate edges are IDENTIFIED_CAUSAL, as it provides more granular policy levers. Use reduced-form if intermediate edges are weak or if you only need the total effect.\n"
  },
  "SIGNIFICANT_BUT_NOT_IDENTIFIED": {
    "description": "Significant result but claim_level != IDENTIFIED_CAUSAL",
    "explanation": "This edge shows a statistically significant result (low p-value), but the identification strategy has not been validated as causal. A significant correlation is not the same as a causal effect \u2014 without proper identification (e.g., IV, RDD, DiD), the estimate may reflect reverse causation, omitted variable bias, or spurious correlation. Accepting this as causal without acknowledgement constitutes overclaiming.\n",
    "guidance": "If you have a credible identification strategy, upgrade to IDENTIFIED_CAUSAL and document it. Otherwise, accept as REDUCED_FORM \u2014 informative but not usable for counterfactual predictions without caveats.\n"
  },
  "SMALL_SAMPLE_INFERENCE": {
    "description": "N &lt; 30 with HAC SEs; inference fragile",
    "explanation": "With fewer than 30 observations, HAC (Newey-West) standard errors rely on asymptotic approximations that perform poorly in small samples. Confidence intervals may be too narrow, leading to false rejections of the null. The credibility rating is capped to reflect this uncertainty.\n",
    "guidance": "Consider wild bootstrap for more reliable small-sample inference. The rating cap to B is automatic; override only if you have strong justification for asymptotic validity.\n"
  },
  "PANEL_TOO_FEW_UNITS": {
    "description": "&lt; 5 units; cluster-robust unreliable",
    "explanation": "Cluster-robust standard errors require a sufficient number of clusters (units) to be reliable. With fewer than 5 units, the cluster-robust variance estimator is severely biased downward, leading to over-rejection. This is a well-known problem in the panel econometrics literature (Cameron, Gelbach, Miller 2008).\n",
    "guidance": "Use wild cluster bootstrap (Webb weights) for valid inference with few clusters. The rating cap to B is automatic. Accept with caveat if bootstrap is infeasible.\n"
  },
  "LOO_INSTABILITY": {
    "description": "Leave-one-out shows sign flip or &gt;50% magnitude change",
    "explanation": "Leave-one-out (LOO) analysis drops each unit in turn and re-estimates. If the coefficient flips sign or changes magnitude by more than 50%, the result is driven by a single influential unit rather than a systematic pattern. Such fragility undermines confidence in the estimate as a general causal effect.\n",
    "guidance": "Identify the influential unit and investigate whether it is an outlier or represents a genuine subgroup effect. Consider winsorizing, trimming, or reporting results with and without the influential unit.\n"
  },
  "BREAKS_UNMODELED": {
    "description": "Regime changes not accounted for in estimation",
    "explanation": "Structural breaks (e.g., policy changes, crises) can cause coefficient instability. If breaks are present but not modeled, the estimated coefficient is a weighted average across regimes, which may not represent either regime accurately. This is especially problematic for counterfactual scenarios that project beyond a break date.\n",
    "guidance": "Add a regime dummy or split the sample at the break date. If the break is recent and data post-break is insufficient, restrict counterfactual scope to the pre-break regime.\n"
  },
  "MULTIPLE_TESTING_DRIFT": {
    "description": "Spec search exceeded pre-registered budget",
    "explanation": "Running many specifications and reporting only the significant one inflates the false discovery rate. The pre-registered specification budget limits this. If the budget is exceeded, the analyst must either apply a multiple testing correction (e.g., Bonferroni) or justify the additional specifications as pre-planned robustness checks.\n",
    "guidance": "Apply Bonferroni correction to the p-values if the budget was exceeded due to exploratory analysis. If the additional specs were planned robustness checks, document them and reset the budget.\n"
  },
  "NONSTATIONARY_LEVELS_RISK": {
    "description": "Both variables in levels and trending; require transformation or ECM",
    "explanation": "Regressing two trending (non-stationary) variables in levels produces spurious regression \u2014 high R-squared and significant t-statistics that reflect shared trends, not causal relationships. The solution is to first-difference, use an ECM if cointegrated, or apply appropriate transformations (log-differences for growth rates).\n",
    "guidance": "The system will apply first-differencing by default. If you believe the variables are cointegrated, select ECM specification to preserve the long-run relationship.\n"
  },
  "RESIDUAL_AUTOCORR_DETECTED": {
    "description": "Serial correlation in residuals; HAC SEs may be inadequate",
    "explanation": "Serial correlation in residuals indicates that the model is missing dynamic structure. While HAC standard errors adjust for this, they may be inadequate if the autocorrelation is strong or persistent, leading to under-estimated standard errors and over-rejection.\n",
    "guidance": "Consider increasing the HAC bandwidth or adding lagged dependent variables. If autocorrelation is mild (DW close to 2), accept with a caveat.\n"
  },
  "REGIME_BREAK_SUSPECTED": {
    "description": "Coefficient instability across regime splits",
    "explanation": "TSGuard detected statistically significant coefficient differences across time sub-samples, suggesting a structural break. Using a single coefficient for the full sample masks regime-specific effects and produces unreliable counterfactuals for periods after the break.\n",
    "guidance": "Split the sample at the detected break date and estimate separately. If the break is too recent for reliable post-break estimation, restrict counterfactual scope to the pre-break regime.\n"
  },
  "LEADS_SIGNIFICANT_TIMING_FAIL": {
    "description": "Effects appear before shock; reverse causation or omitted factor",
    "explanation": "If the outcome responds significantly BEFORE the treatment shock, the causal interpretation fails. This indicates either reverse causation (outcome causes treatment), an omitted common factor driving both, or anticipation effects that violate the parallel trends assumption. The edge is blocked from propagation automatically.\n",
    "guidance": "Investigate whether leads reflect anticipation (expected policy changes) or reverse causation. If anticipation, consider adjusting the shock timing. If reverse causation, reclassify the edge direction or remove from the DAG.\n"
  },
  "HAC_LAG_SENSITIVITY_HIGH": {
    "description": "Estimate changes materially with HAC lag length",
    "explanation": "If the point estimate or its significance changes substantially when varying the HAC bandwidth (number of lags in the Newey-West kernel), the inference is fragile to the choice of bandwidth. This suggests that the serial correlation structure is complex and the standard errors are not robust to bandwidth selection.\n",
    "guidance": "Report results across multiple bandwidths. Use a data-driven bandwidth selector (e.g., Andrews 1991) rather than ad hoc choice. Accept with caveat if the sign is stable across bandwidths.\n"
  },
  "SELECTION_PUBLIC_BANK_ONLY": {
    "description": "Panel uses only public banks; results may not generalize to full banking sector",
    "explanation": "Public (listed) banks differ systematically from private banks in size, governance, risk appetite, and regulatory scrutiny. Estimates from public-only samples may not generalize to the full banking sector. Counterfactuals applied to the full sector using these estimates would be unreliable for the private bank segment.\n",
    "guidance": "Add a disclaimer noting the sample restriction. Cap the counterfactual scope to public banks only, or accept with a clear caveat about external validity limitations.\n"
  },
  "SURVIVORSHIP_BIAS_RISK": {
    "description": "Sample excludes failed/merged banks; survival conditioning biases estimates",
    "explanation": "If banks that failed, merged, or exited the sample are excluded, the remaining sample is conditioned on survival. This creates survivorship bias \u2014 the estimated effects reflect only the experience of survivors, typically underestimating the negative effects of shocks (since the most affected banks disappeared).\n",
    "guidance": "Run a sensitivity check including failed/merged banks up to their last observation. Add a disclaimer about survivorship bias. If data on exits is unavailable, accept with a clear caveat.\n"
  },
  "COVERAGE_GAP_EXTERNAL_VALIDITY": {
    "description": "Sample covers &lt;50% of system assets or &lt;50% of institutions in target population",
    "explanation": "When the sample covers less than half of the target population (by assets or count), the estimated effects may not represent the system as a whole. Small or mid-sized banks excluded from the sample may have different exposure patterns and response mechanisms than the included banks.\n",
    "guidance": "Add a disclaimer noting the coverage gap. If the coverage gap is due to data availability, document which segments are missing and their likely direction of bias.\n"
  },
  "RATING_DIAGNOSTICS_CONFLICT": {
    "description": "A-rating despite failed diagnostics or missing requirements",
    "explanation": "An A-rating signals high credibility, but one or more diagnostics have failed or required checks are missing. This inconsistency undermines the rating system&#x27;s integrity. The system auto-downgrades to B to maintain consistency between the rating and the underlying evidence.\n",
    "guidance": "The auto-downgrade to B is applied. Override to A only if you can document why the failed diagnostic does not affect the estimate&#x27;s credibility for your specific use case.\n"
  },
  "N_REPORTING_INCONSISTENT": {
    "description": "Report N header != EdgeCard N_eff",
    "explanation": "The sample size reported in the system report header differs from the effective observations in the EdgeCard. This inconsistency confuses reviewers and may indicate a data processing error (e.g., missing values were dropped but not reflected in the header count).\n",
    "guidance": "The system will auto-fix by aligning the report N to the EdgeCard N_eff. Accept the auto-fix unless you have a specific reason for the discrepancy.\n"
  },
  "CROSS_EVIDENCE_CONFLICT": {
    "description": "Two edges measuring same relationship have conflicting signs",
    "explanation": "When two edges estimate the same causal relationship (e.g., one reduced-form and one structural) but produce opposite signs, at least one is biased or misspecified. Using both in propagation would produce contradictory counterfactuals. The analyst must adjudicate which estimate is more credible.\n",
    "guidance": "Prefer the structural edge if its identification strategy is stronger. If both designs are equally credible, report the conflict as a limitation and consider averaging with appropriate uncertainty.\n"
  },
  "ORPHAN_NODE_UNCONNECTED": {
    "description": "Node not connected to any edge; unreachable in propagation",
    "explanation": "A node exists in the DAG but does not appear in any edge&#x27;s from/to or latent&#x27;s affects list. If the node has an identity formula whose components are all present in the DAG, an identity edge can be auto-created. Otherwise, human intervention is required to either add a causal edge with estimation backing or remove the node.\n",
    "guidance": "For identity-resolvable orphans, the system creates a deterministic identity edge and edge card. For others, add an edge with proper estimation or remove the orphan node from the DAG.\n"
  },
  "TARGET_UNREACHABLE": {
    "description": "Target node is unreachable from any root node in the DAG",
    "explanation": "The target node (the variable the DAG is designed to explain) cannot be reached by following edges from any exogenous root node. This means the causal narrative is structurally broken \u2014 shocks cannot propagate to the target. Common causes include missing identity edges, disconnected components, or incomplete narrative extraction.\n",
    "guidance": "Add the missing edges that connect the exogenous shock chain to the target. For identity nodes (e.g., K2 = Capital / RWA), ensure both identity component edges exist.\n"
  },
  "IDENTITY_DEPS_INCOMPLETE": {
    "description": "Derived node&#x27;s identity formula has dependencies without edges",
    "explanation": "A derived node has an identity formula (e.g., K2 = Capital / RWA) that references dependency nodes, but one or more of those dependencies lack an edge pointing to the derived node. This breaks the accounting identity chain and prevents correct propagation through the identity relationship.\n",
    "guidance": "The system will auto-create identity edges from each dependency to the derived node. Accept if the dependencies are correctly specified in the formula.\n"
  },
  "SINK_NODE_NOT_TARGET": {
    "description": "Non-target node absorbs information but does not transmit downstream",
    "explanation": "A node has incoming edges but no outgoing edges, yet it is not the DAG&#x27;s target node. This means information (shocks) flow into this node but are absorbed without transmitting further. If the node is meant to influence downstream variables, the missing outgoing edge represents a gap in the causal narrative.\n",
    "guidance": "Either add an outgoing edge to connect this node downstream, or accept this as a terminal diagnostic node that is not part of the propagation chain.\n"
  },
  "EDGE_ID_SYNTAX_INVALID": {
    "description": "Edge ID contains spaces, arrows, or other invalid characters",
    "explanation": "Edge IDs must be valid snake_case identifiers (lowercase letters, digits, underscores only). IDs containing spaces, arrows (-&gt;), parentheses, or other special characters cause filesystem errors when saving EdgeCards and break downstream tooling that expects clean identifiers.\n",
    "guidance": "The system will auto-sanitize the edge ID by converting arrows to _to_, removing special characters, and collapsing consecutive underscores.\n"
  },
  "IDENTITY_FORMULA_DOUBLE_TRANSFORM": {
    "description": "Identity formula applies log() to a node already stored in log form",
    "explanation": "A derived node&#x27;s identity formula contains log(X) where X already has transforms: [log], meaning the data is already in log levels. Applying log() again would double-log the variable, producing incorrect results. This is usually a documentation convention issue rather than a runtime bug, but it creates ambiguity about whether the formula represents a mathematical operation or a label.\n",
    "guidance": "If the convention is that transforms: [log] means &quot;data stored in log form&quot;, then the formula should use the variable name directly (e.g., X - Y instead of log(X) - log(Y)). Update the formula to match.\n"
  },
  "UNIT_MISSING_IN_EDGECARD": {
    "description": "EdgeCard missing treatment_unit/outcome_unit",
    "explanation": "Without explicit units (e.g., &quot;pp&quot;, &quot;%&quot;, &quot;log points&quot;), the coefficient is uninterpretable. A coefficient of 0.5 could mean 0.5 percentage points, 50%, or 0.5 log points \u2014 a potential 100x difference in the implied effect. Units are required for any meaningful propagation or reporting.\n",
    "guidance": "The system will auto-populate units from the DAG spec. Verify that the inferred units match the actual estimation specification.\n"
  }
};
const ACTIONS_BY_RULE = {
  "SIGNIFICANT_BUT_NOT_IDENTIFIED": {
    "action_type": "set_claim_level",
    "options": [
      {
        "value": "IDENTIFIED_CAUSAL",
        "label": "IDENTIFIED_CAUSAL",
        "tooltip": "Asserts credible identification strategy (IV, RDD, DiD). Requires documentation. Unlocks counterfactual propagation at full weight."
      },
      {
        "value": "REDUCED_FORM",
        "label": "REDUCED_FORM",
        "tooltip": "Informative but not causally identified. Flagged in reports, excluded from causal counterfactuals. Useful for suggestive evidence."
      },
      {
        "value": "DESCRIPTIVE",
        "label": "DESCRIPTIVE",
        "tooltip": "Descriptive association only. No causal weight in propagation or counterfactuals. Kept for reporting and context."
      },
      {
        "value": "BLOCKED_ID",
        "label": "BLOCKED_ID",
        "tooltip": "Blocks identification claim entirely. Edge remains in DAG but cannot be used for propagation until resolved."
      }
    ]
  },
  "REACTION_FUNCTION_EDGE": {
    "action_type": "set_propagation",
    "options": [
      {
        "value": "RECLASSIFY_DIAGNOSTIC",
        "label": "Reclassify as diagnostic",
        "tooltip": "Moves edge to diagnostic-only role. It will appear in reports but not participate in shock propagation or counterfactuals."
      },
      {
        "value": "ACCEPT_WITH_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps edge in propagation but adds an explicit caveat about endogeneity to all downstream counterfactuals."
      },
      {
        "value": "BLOCK_PROPAGATION",
        "label": "Block from propagation",
        "tooltip": "Removes edge from all propagation paths. It remains visible in the DAG for documentation but has zero causal weight."
      }
    ]
  },
  "TIME_FE_ABSORBS_SHOCK": {
    "action_type": "set_design_fix",
    "options": [
      {
        "value": "ADD_INTERACTION",
        "label": "Add Exposure x Shock",
        "tooltip": "Adds cross-sectional exposure interaction to identify effects absorbed by time FE. Standard DiD approach for common macro shocks."
      },
      {
        "value": "DROP_TIME_FE",
        "label": "Drop time FE",
        "tooltip": "Removes time fixed effects to allow common shock identification. Risks confounding from other time-varying factors."
      },
      {
        "value": "ACCEPT",
        "label": "Accept (document)",
        "tooltip": "Keeps current specification. Documents that the common shock effect is absorbed and the estimate captures only cross-sectional variation."
      }
    ]
  },
  "EXPOSURE_NOT_PREDETERMINED": {
    "action_type": "set_exposure_action",
    "options": [
      {
        "value": "LAG_EXPOSURE",
        "label": "Lag exposure variable",
        "tooltip": "Uses pre-treatment period exposure measurement to avoid bad controls bias. Recommended if pre-treatment data is available."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps contemporaneous exposure with a documented caveat about potential attenuation bias from endogenous exposure."
      },
      {
        "value": "BLOCK_ID",
        "label": "Block identification claim",
        "tooltip": "Downgrades identification to REDUCED_FORM. The edge cannot claim causal identification without predetermined exposure."
      }
    ]
  },
  "MECHANICAL_EDGE_ESTIMATED": {
    "action_type": "set_edge_type",
    "options": [
      {
        "value": "CONVERT_BRIDGE",
        "label": "Convert to bridge edge",
        "tooltip": "Replaces regression with deterministic sensitivity (partial derivative). Eliminates wasted estimation budget on tautological relationships."
      },
      {
        "value": "ACCEPT",
        "label": "Accept as regression",
        "tooltip": "Keeps the regression estimate. Useful if you want to empirically test whether the identity holds (e.g., detecting measurement error)."
      }
    ]
  },
  "PATH_DOUBLE_COUNTING": {
    "action_type": "set_path_choice",
    "options": [
      {
        "value": "USE_STRUCTURAL",
        "label": "Use structural chain",
        "tooltip": "Uses the full structural decomposition (A-&gt;B-&gt;C). Provides more granular policy levers but requires all intermediate edges to be credible."
      },
      {
        "value": "USE_REDUCED_FORM",
        "label": "Use reduced-form shortcut",
        "tooltip": "Uses the direct reduced-form edge (A-&gt;C). Simpler and more robust if intermediate edges are weak, but loses structural detail."
      },
      {
        "value": "ACCEPT_BOTH",
        "label": "Accept both (document)",
        "tooltip": "Keeps both paths with documentation. Only valid if paths measure different aspects (e.g., short-run vs long-run effects)."
      }
    ]
  },
  "ENTITY_BOUNDARY_DRIFT": {
    "action_type": "set_boundary_action",
    "options": [
      {
        "value": "HARMONIZE",
        "label": "Harmonize to common scope",
        "tooltip": "Converts all observations to the same entity scope (bank-level or group-level). May require data adjustments."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps mixed scopes with a documented caveat. Appropriate when scope differences are small or unavoidable."
      },
      {
        "value": "EXCLUDE_EDGE",
        "label": "Exclude edge",
        "tooltip": "Removes the edge from estimation entirely. Use when scope mixing makes the estimate unreliable."
      }
    ]
  },
  "KPI_DEFINITION_MISMATCH_CROSS_BANK": {
    "action_type": "set_kpi_action",
    "options": [
      {
        "value": "HARMONIZE",
        "label": "Harmonize definitions",
        "tooltip": "Adjusts data to use consistent definitions across banks. May require recalculation from raw components."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps heterogeneous definitions with documentation. Appropriate if differences are minor or well-understood."
      },
      {
        "value": "EXCLUDE_EDGE",
        "label": "Exclude edge",
        "tooltip": "Removes the edge. Use when definition differences are fundamental and cannot be reconciled."
      }
    ]
  },
  "SHOCK_CONSTRUCT_AMBIGUOUS": {
    "action_type": "set_shock_action",
    "options": [
      {
        "value": "ADD_METADATA",
        "label": "Add shock metadata",
        "tooltip": "Populates missing shock_node_id, shock_unit, and shock_scale from DAG spec. Required for counterfactual scenarios."
      },
      {
        "value": "ACCEPT",
        "label": "Accept as-is",
        "tooltip": "Keeps edge without shock metadata. Edge will not be usable in counterfactual scenarios."
      }
    ]
  },
  "FREQUENCY_ALIGNMENT_ERROR": {
    "action_type": "set_freq_action",
    "options": [
      {
        "value": "AGGREGATE_Q",
        "label": "Aggregate to quarterly",
        "tooltip": "Aggregates higher-frequency data to quarterly using the DAG-specified method (average for flows, end-of-period for stocks)."
      },
      {
        "value": "AGGREGATE_A",
        "label": "Aggregate to annual",
        "tooltip": "Aggregates to annual frequency. Loses short-run dynamics but may be necessary for data availability reasons."
      },
      {
        "value": "ACCEPT",
        "label": "Accept (document)",
        "tooltip": "Keeps mixed frequencies with documentation. Only appropriate if the estimator handles mixed frequencies natively."
      }
    ]
  },
  "FREQUENCY_SCALING_MISMATCH": {
    "action_type": "set_scaling_action",
    "options": [
      {
        "value": "NORMALIZE",
        "label": "Normalize to common unit",
        "tooltip": "Rescales coefficients to a common time unit (quarterly convention). Ensures cross-run comparability."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps different time units with documentation. Cross-run comparisons will include unit conversion caveats."
      }
    ]
  },
  "EXTRACTION_PROVENANCE_GAPS": {
    "action_type": "set_provenance_action",
    "options": [
      {
        "value": "ADD_SOURCE",
        "label": "Add source reference",
        "tooltip": "Adds source document, page, and table reference to the data extraction metadata for audit trail."
      },
      {
        "value": "ACCEPT",
        "label": "Accept (low risk)",
        "tooltip": "Accepts without provenance. Appropriate for public market data or well-known statistical series."
      }
    ]
  },
  "SMALL_SAMPLE_INFERENCE": {
    "action_type": "set_sample_action",
    "options": [
      {
        "value": "CAP_B",
        "label": "Cap rating to B",
        "tooltip": "Limits credibility rating to B, reflecting asymptotic approximation risk with N &lt; 30. Automatic default action."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps current rating with documented small-sample caveat. Only if you have justification for asymptotic validity."
      },
      {
        "value": "RE_ESTIMATE",
        "label": "Flag for re-estimation",
        "tooltip": "Queues re-estimation with wild bootstrap standard errors for more reliable small-sample inference."
      }
    ]
  },
  "PANEL_TOO_FEW_UNITS": {
    "action_type": "set_panel_action",
    "options": [
      {
        "value": "CAP_B",
        "label": "Cap rating to B",
        "tooltip": "Limits rating to B due to cluster-robust SE unreliability with &lt; 5 units. Automatic default action."
      },
      {
        "value": "WILD_BOOTSTRAP",
        "label": "Use wild cluster bootstrap",
        "tooltip": "Re-estimates with wild cluster bootstrap (Webb weights) for valid few-cluster inference. May widen confidence intervals."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps current estimate with documented caveat about few-cluster inference fragility."
      }
    ]
  },
  "LOO_INSTABILITY": {
    "action_type": "set_loo_action",
    "options": [
      {
        "value": "CAP_C",
        "label": "Cap rating to C",
        "tooltip": "Limits rating to C reflecting result fragility to single-unit exclusion. Signals low confidence in generalizability."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps current rating with documented LOO instability caveat. Identify the influential unit in the rationale."
      },
      {
        "value": "RE_ESTIMATE",
        "label": "Flag for re-estimation",
        "tooltip": "Queues re-estimation with the influential unit excluded or winsorized. Produces a robustness comparison."
      }
    ]
  },
  "BREAKS_UNMODELED": {
    "action_type": "set_breaks_action",
    "options": [
      {
        "value": "ADD_REGIME",
        "label": "Add regime dummy",
        "tooltip": "Adds a structural break dummy at the detected break date. Allows coefficient to differ across regimes."
      },
      {
        "value": "SPLIT_SAMPLE",
        "label": "Split sample estimation",
        "tooltip": "Estimates separately for each regime. Provides regime-specific coefficients for targeted counterfactuals."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps pooled estimate with caveat about coefficient averaging across regimes."
      }
    ]
  },
  "MULTIPLE_TESTING_DRIFT": {
    "action_type": "set_testing_action",
    "options": [
      {
        "value": "BONFERRONI",
        "label": "Apply Bonferroni correction",
        "tooltip": "Adjusts p-values for the number of specifications tested. Conservative but protects against false discoveries."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps unadjusted p-values with documentation of the specification search. Appropriate for pre-planned robustness."
      },
      {
        "value": "RESET_BUDGET",
        "label": "Reset spec budget",
        "tooltip": "Resets the specification budget counter. Use only if the additional specs were pre-planned and documented."
      }
    ]
  },
  "NONSTATIONARY_LEVELS_RISK": {
    "action_type": "set_stationarity_action",
    "options": [
      {
        "value": "DIFFERENCE",
        "label": "First-difference",
        "tooltip": "Applies first-differencing to both variables. Removes trends but loses long-run level information."
      },
      {
        "value": "ECM",
        "label": "Use ECM specification",
        "tooltip": "Uses Error Correction Model to preserve long-run relationship while modeling short-run dynamics. Requires cointegration."
      },
      {
        "value": "ACCEPT",
        "label": "Accept (document)",
        "tooltip": "Keeps levels specification with documentation. Only valid if you have theoretical reasons for level relationships."
      }
    ]
  },
  "RESIDUAL_AUTOCORR_DETECTED": {
    "action_type": "set_autocorr_action",
    "options": [
      {
        "value": "INCREASE_HAC",
        "label": "Increase HAC bandwidth",
        "tooltip": "Increases Newey-West kernel bandwidth to better capture serial correlation. May widen standard errors."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps current HAC bandwidth with documented autocorrelation caveat. Appropriate for mild autocorrelation."
      }
    ]
  },
  "REGIME_BREAK_SUSPECTED": {
    "action_type": "set_regime_action",
    "options": [
      {
        "value": "ADD_BREAK",
        "label": "Add structural break",
        "tooltip": "Adds break dummy and interaction terms at the detected break date. Allows before/after comparison."
      },
      {
        "value": "SPLIT_SAMPLE",
        "label": "Split sample",
        "tooltip": "Estimates separately for pre-break and post-break periods. Provides regime-specific coefficients."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps pooled estimate with documented regime instability caveat."
      }
    ]
  },
  "LEADS_SIGNIFICANT_TIMING_FAIL": {
    "action_type": "set_timing_action",
    "options": [
      {
        "value": "BLOCK_PROPAGATION",
        "label": "Block from propagation",
        "tooltip": "Removes edge from all propagation paths. Automatic action for timing failures. Edge kept for diagnostic purposes."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat (document)",
        "tooltip": "Keeps edge with documented timing failure. Only valid if leads reflect anticipated policy changes, not reverse causation."
      },
      {
        "value": "RE_ESTIMATE",
        "label": "Flag for re-estimation",
        "tooltip": "Queues re-estimation with adjusted shock timing or additional lead/lag structure to investigate timing failure."
      }
    ]
  },
  "HAC_LAG_SENSITIVITY_HIGH": {
    "action_type": "set_hac_action",
    "options": [
      {
        "value": "USE_FIXED_BW",
        "label": "Fix HAC bandwidth",
        "tooltip": "Uses a fixed, data-driven bandwidth (Andrews 1991). Removes sensitivity to ad hoc bandwidth choice."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps current estimate with documented bandwidth sensitivity caveat. Report results across multiple bandwidths."
      }
    ]
  },
  "SELECTION_PUBLIC_BANK_ONLY": {
    "action_type": "set_selection_action",
    "options": [
      {
        "value": "ADD_DISCLAIMER",
        "label": "Add report disclaimer",
        "tooltip": "Adds explicit sample restriction disclaimer to the system report. Results clearly labeled as public-bank-only."
      },
      {
        "value": "CAP_SCOPE",
        "label": "Cap counterfactual scope",
        "tooltip": "Restricts counterfactual predictions to public banks only. Prevents extrapolation to non-sampled bank types."
      },
      {
        "value": "ACCEPT",
        "label": "Accept as-is",
        "tooltip": "No action taken. Use only if the target population is specifically public banks."
      }
    ]
  },
  "SURVIVORSHIP_BIAS_RISK": {
    "action_type": "set_survivorship_action",
    "options": [
      {
        "value": "ADD_DISCLAIMER",
        "label": "Add report disclaimer",
        "tooltip": "Adds survivorship bias disclaimer. Notes that estimates may understate negative effects due to exit selection."
      },
      {
        "value": "SENSITIVITY_CHECK",
        "label": "Run sensitivity check",
        "tooltip": "Re-estimates including failed/merged banks up to their last observation. Compares with survivor-only estimates."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Keeps survivor-only estimate with documented caveat about potential downward bias in negative effect estimates."
      }
    ]
  },
  "COVERAGE_GAP_EXTERNAL_VALIDITY": {
    "action_type": "set_coverage_action",
    "options": [
      {
        "value": "ADD_DISCLAIMER",
        "label": "Add report disclaimer",
        "tooltip": "Adds coverage gap disclaimer. Documents which segments of the target population are missing from the sample."
      },
      {
        "value": "ACCEPT_CAVEAT",
        "label": "Accept with caveat",
        "tooltip": "Accepts with documented coverage limitation. Notes direction of likely bias from missing segments."
      }
    ]
  },
  "RATING_DIAGNOSTICS_CONFLICT": {
    "action_type": "set_rating",
    "options": [
      {
        "value": "DOWNGRADE_B",
        "label": "Downgrade to B",
        "tooltip": "Downgrades from A to B due to failed diagnostics. Standard action to maintain rating-evidence consistency."
      },
      {
        "value": "DOWNGRADE_C",
        "label": "Downgrade to C",
        "tooltip": "Downgrades to C for severe diagnostic failures (multiple failed checks or critical timing failure)."
      },
      {
        "value": "ACCEPT",
        "label": "Accept (document)",
        "tooltip": "Keeps A rating despite diagnostic issues. Requires strong justification documented in rationale."
      }
    ]
  },
  "N_REPORTING_INCONSISTENT": {
    "action_type": "set_n_action",
    "options": [
      {
        "value": "FIX_REPORT",
        "label": "Fix report N",
        "tooltip": "Updates the system report header to match EdgeCard N_eff. Standard fix for reporting inconsistencies."
      },
      {
        "value": "FIX_EDGECARD",
        "label": "Fix EdgeCard N_eff",
        "tooltip": "Updates EdgeCard N_eff to match report header. Use only if the report header is the authoritative source."
      },
      {
        "value": "ACCEPT",
        "label": "Accept (document)",
        "tooltip": "Keeps inconsistency with documentation. Only if the discrepancy reflects a deliberate methodological choice."
      }
    ]
  },
  "CROSS_EVIDENCE_CONFLICT": {
    "action_type": "set_conflict_action",
    "options": [
      {
        "value": "PREFER_STRUCTURAL",
        "label": "Prefer structural edge",
        "tooltip": "Uses the structural (better-identified) edge estimate. The conflicting reduced-form edge is demoted to diagnostic-only."
      },
      {
        "value": "PREFER_REDUCED",
        "label": "Prefer reduced-form edge",
        "tooltip": "Uses the reduced-form edge estimate. The structural edge is demoted. Appropriate if structural identification is suspect."
      },
      {
        "value": "ACCEPT_BOTH",
        "label": "Accept both (document)",
        "tooltip": "Keeps both estimates with documented conflict. Reports will show both with an explicit conflict warning."
      }
    ]
  },
  "UNIT_MISSING_IN_EDGECARD": {
    "action_type": "set_unit_action",
    "options": [
      {
        "value": "ADD_UNITS",
        "label": "Add units from spec",
        "tooltip": "Auto-populates treatment_unit and outcome_unit from the DAG node specifications. Standard auto-fix."
      },
      {
        "value": "ACCEPT",
        "label": "Accept (not critical)",
        "tooltip": "Keeps edge without explicit units. Only for edges not used in propagation where unit ambiguity is acceptable."
      }
    ]
  },
  "_default": {
    "action_type": "resolve",
    "options": [
      {
        "value": "ACCEPT",
        "label": "Accept",
        "tooltip": "Accepts the issue without further action. The issue is marked as resolved."
      },
      {
        "value": "REJECT",
        "label": "Reject",
        "tooltip": "Rejects the flagged finding. The edge remains as-is but the rejection is logged for audit."
      },
      {
        "value": "ESCALATE",
        "label": "Escalate",
        "tooltip": "Escalates to senior reviewer or domain expert. Issue remains open until resolved by escalation target."
      }
    ]
  }
};
const GENERATED_AT = "2026-02-11 19:52:25 UTC";
const ISSUE_GUIDANCE = {
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:rwa_kspi_to_k2_ratio_kspi": "**Finding**: The edge `rwa_kspi_to_k2_ratio_kspi` is statistically significant with a negative coefficient of **-0.00606** (SE **0.00205**, **p=0.00309**, **N=25**) under **LOCAL_PROJECTIONS**, but it is flagged **claim_level=BLOCKED_ID**.\n\n**Concern**: Despite the low p-value, causal interpretation is not credible because the edge **fails the `ts_leads_test`** (a key pre-trend/anticipation diagnostic), meaning the outcome appears to move **before** the purported shock and the estimated effect could reflect reverse causality or omitted time-varying confounding rather than `rwa_kspi` causing changes in `k2_ratio_kspi`.\n\n**Recommendation**: Keep the claim **blocked for causal use** and treat the estimate (**-0.00606**, p=0.00309) as **associational only** until you re-specify and re-estimate in a way that passes `ts_leads_test` (e.g., adjust timing/lag structure in the local projection, add relevant controls/time effects, or use an identification strategy like an IV or stronger quasi-experimental design); if you must act now, base decisions on robustness across specifications rather than this single significant-but-not-identified result.",
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:cpi_nontradable_to_cpi_headline": "**Finding**: The edge **cpi_nontradable \u2192 cpi_headline** is statistically significant (**coef = 0.7221**, **SE = 0.2269**, **p = 0.001459**, **N = 176**, LOCAL_PROJECTIONS) but is marked **BLOCKED_ID** with a **failed ts_leads_test**.\n\n**Concern**: Despite the strong p-value (0.001459), the **failed ts_leads_test** indicates violations consistent with **non-causal timing/anticipation or residual confounding**, so treating 0.7221 as a causal effect risks attributing predictive correlation to causation, directly contradicting the **BLOCKED_ID** identification status.\n\n**Recommendation**: Keep the claim **blocked for causal interpretation** and either (i) **repair identification** by modifying the LP specification to pass the **ts_leads_test** (e.g., add/adjust leads/lags and controls until leads are jointly null), or (ii) if you must use it now, **downgrade the statement to predictive association** (\u201ca 1-unit increase in nontradable CPI is associated with +0.722 in headline CPI\u201d) and do not use it for policy/counterfactual decisions until the leads test passes.",
  "RATING_DIAGNOSTICS_CONFLICT:cpi_nontradable_to_cpi_headline": "**Finding**: The edge **cpi_nontradable \u2192 cpi_headline** has a sizable, precisely estimated effect (**\u03b2 = 0.7221**, **SE = 0.2269**, **p = 0.00146**, **N = 176**) and is rated **A**, but it **fails the ts_leads_test**.\n\n**Concern**: A failed **ts_leads_test** indicates statistically detectable effects **before** the \u201ctreatment\u201d (lead effects), which is consistent with **anticipation/reverse causality or omitted time-varying confounding**, so the strong significance (**p = 0.00146**) may reflect **non-causal predictability** rather than a valid causal impact\u2014making the **A rating internally inconsistent** given the diagnostic failure.\n\n**Recommendation**: **Downgrade the edge from A to at most B/C (or set to \u201cneeds review\u201d) unless you can eliminate the lead effects**, and re-estimate with a specification that addresses the leads failure (e.g., add stronger lags/controls, adjust timing/measurement, include unit/time trends as appropriate, or change identification), only restoring an A if **ts_leads_test passes** or the pre-effect is shown to be economically/statistically negligible.",
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:kzt_usd_to_cpi_nontradable": "**Finding**: The edge **kzt_usd_to_cpi_nontradable** has a positive estimated effect of **7.68e-05** with **SE=3.38e-05** and is statistically significant (**p=0.0231**, **N=186**) under **LOCAL_PROJECTIONS**, but the claim level is **REDUCED_FORM**.\n\n**Concern**: Because this result is explicitly **reduced-form**, the **p=0.0231** significance only indicates a predictive/associational relationship and does not rule out confounding (e.g., shared monetary policy shocks or demand shocks affecting both KZT/USD and nontradable CPI), so treating it as causal would overstate validity even though **no diagnostics failed**.\n\n**Recommendation**: Keep this edge as **evidence of association/forecasting or as a reduced-form pass-through estimate**, but **do not promote it to a causal claim** without adding an identification strategy (e.g., an instrument or a clearly exogenous shock for exchange-rate movements, plus sensitivity/robustness checks) to move beyond **REDUCED_FORM**.",
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:real_expenditure_to_ppop_kspi": "**Finding**: The estimated edge effect is **-0.7733** with an implausibly tiny **SE = 5.95e-12** and **p = 0.0000** based on **N = 6** under **LOCAL_PROJECTIONS** while the claim level remains **REDUCED_FORM** (Rating **C**).\n\n**Concern**: Despite the \u201csignificant\u201d p-value, causal validity is undermined because multiple key diagnostics failed (**effective_obs**, **ts_residual_autocorr**, **ts_lag_sensitivity**, **ts_shock_support**), and with only **6 observations** the near-zero SE strongly suggests model/pathology (e.g., overfitting, deterministic fit, or miscomputed uncertainty), so the estimate cannot credibly be interpreted as causal.\n\n**Recommendation**: Treat this result as **non-identifying reduced-form evidence only** (do **not** make causal claims) and **re-estimate** after addressing the failed diagnostics\u2014most importantly increase effective sample size beyond **N = 6**, correct for serial correlation in LP inference, test robustness to lag/spec choices, and verify the shock has adequate support\u2014then reassess whether the coefficient near **-0.7733** persists with realistic standard errors.",
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:cor_kspi_to_total_capital_kspi": "**Finding**: The LOCAL_PROJECTIONS estimate for **cor_kspi_to_total_capital_kspi** is **-8.2799** (SE **0.9271**) with an extremely small p-value (**4.23e-19**, **N=25**), yet the claim is **BLOCKED_ID**.\n\n**Concern**: Despite high statistical significance, causal interpretation is not credible because the **ts_leads_test failed**, indicating evidence consistent with **pre-trends/anticipation (non-zero leads)** and therefore potential violation of the identifying assumption (the \u201ceffect\u201d may be present before the shock), which is why the edge is blocked.\n\n**Recommendation**: Treat this estimate as **non-causal and do not use it for causal claims** unless you can resolve the failed **ts_leads_test**\u2014e.g., re-specify the model to address pre-trends (add appropriate controls/trends, adjust timing/definition of the shock, shorten the horizon, or use an alternative identification strategy such as an instrument or a design that improves exogeneity); otherwise, at most report it as a **descriptive association with strong evidence of non-identification**.",
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:ppop_kspi_to_total_capital_kspi": "**Finding**: The edge `ppop_kspi \u2192 total_capital_kspi` is highly statistically significant (\u03b2 = 67.40, SE = 8.21, p = 2.22e-16, N = 15) but is flagged as `claim_level = BLOCKED_ID` despite a rating of B.  \n\n**Concern**: With `effective_obs` and `ts_leads_test` failing, the estimate likely relies on too few effective time-series observations and shows evidence consistent with pre-trends/anticipation, so the very low p-value does not support a credible causal interpretation under LOCAL_PROJECTIONS.  \n\n**Recommendation**: Treat this link as non-causal and do not use it for causal decisions until you (i) increase effective sample support (more periods or fewer leads/lags) and (ii) resolve the leads/pre-trend failure (re-specify the LP, adjust timing, add controls/fixed effects, or change identification strategy); otherwise, downgrade its use to descriptive/predictive association only.",
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:cpi_tradable_to_cpi_headline": "**Finding**: The LOCAL_PROJECTIONS estimate for **cpi_tradable \u2192 cpi_headline** is large and highly significant (**\u03b2 = 0.7618**, **SE = 0.0433**, **p = 3.33e-69**, **N = 176**) despite being labeled **claim_level = BLOCKED_ID**.\n\n**Concern**: This edge fails the **ts_leads_test**, meaning there is evidence consistent with **anticipatory effects/reverse causality or omitted time-varying confounding**, so the extremely low p-value does not rescue causal interpretation and the identification claim is correctly blocked.\n\n**Recommendation**: Keep the edge **non-causal/blocked for decision use** until you re-specify to pass the **leads test**\u2014e.g., add stronger lag structures and relevant controls, re-estimate with alternative identification (instrument/structural shock or tighter exogeneity assumptions), and only upgrade the claim level if the lead coefficients become jointly insignificant while the contemporaneous/lags remain stable (otherwise treat this as predictive association only).",
  "RATING_DIAGNOSTICS_CONFLICT:cpi_tradable_to_cpi_headline": "**Finding**: The edge `cpi_tradable_to_cpi_headline` has a large, precisely estimated coefficient of **0.7618** (SE **0.0433**, **p = 3.33e-69**, **N = 176**) and is rated **A** despite a **failed `ts_leads_test`** under **LOCAL_PROJECTIONS** at **BLOCKED_ID** claim level.\n\n**Concern**: Failing the `ts_leads_test` indicates evidence of **pre-trends/anticipation (non-zero leads)**, so even with an extremely significant estimate (**p = 3.33e-69**), the causal interpretation is threatened because the identifying assumption of **no effect before treatment/shock** is violated.\n\n**Recommendation**: **Do not treat the A-rating as causal**\u2014downgrade the edge (e.g., to **C/Blocked**) or keep it **blocked for causal claims** unless you can fix the lead violation by re-specifying the LP (e.g., adjust timing/definition of the shock, add controls/lags, shorten horizon, or use an alternative identification strategy) and then **re-run `ts_leads_test`** to confirm leads are jointly insignificant.",
  "SIGNIFICANT_BUT_NOT_IDENTIFIED:nominal_income_to_real_income": "**Finding**: The estimated effect on the edge **nominal_income \u2192 real_income** is large and extremely statistically significant (**\u03b2 = 0.9331**, **SE = 0.0277**, **p = 1.17e-248**, **N = 56**) under **LOCAL_PROJECTIONS**, yet the claim level remains **BLOCKED_ID** due to a **failed ts_leads_test**.\n\n**Concern**: Despite the tiny p-value, the **ts_leads_test** failure indicates evidence consistent with **pre-trends / reverse causality / anticipatory effects**, so treating **\u03b2 = 0.9331** as causal would likely violate the identification assumptions even though the estimate is precisely measured.\n\n**Recommendation**: Keep the edge **blocked for causal claims** and either (i) re-specify the local projections to address the failed leads test (e.g., add controls for confounders, adjust timing/lags, include fixed effects/trends, reconsider the shock definition, or narrow the window) and only \u201cunblock\u201d if leads become jointly insignificant, or (ii) if re-specification is not feasible, re-label the result as **predictive/associational** and exclude it from causal pathways despite the **A rating** and **p = 1.17e-248**.",
  "RATING_DIAGNOSTICS_CONFLICT:nominal_income_to_real_income": "**Finding**: The edge **nominal_income \u2192 real_income** has a large, precisely estimated coefficient (**0.9331**, SE **0.0277**) with an extremely small p-value (**1.17e-248**, N **56**), yet it is rated **A** despite a failed **ts_leads_test** diagnostic.\n\n**Concern**: Failing **ts_leads_test** indicates evidence of **pre-trends / reverse timing (the outcome moving before the \u201ccause\u201d)**, which directly threatens causal interpretation in LOCAL_PROJECTIONS\u2014so the statistically strong estimate (**0.9331**) may be capturing anticipation, common shocks, or mis-timed dynamics rather than a valid causal effect, making the **A rating inconsistent with the diagnostic failure**.\n\n**Recommendation**: **Do not treat this edge as A for causal claims**\u2014downgrade the rating (at least to \u201cquestionable\u201d) or block causal usage until the lead effects are resolved by re-specifying timing/dynamics (e.g., adjust lag/lead structure or alignment) and only reinstate a high rating if **ts_leads_test** passes while the estimate remains stable (given N **56**, prioritize robustness over the tiny p-value)."
};
const ORPHAN_EXPLANATIONS = {};
const CAUSAL_ASSESSMENTS = {
  "kzt_usd_to_cpi_tradable": "**Strategy**: Reduced-form local projections estimating the dynamic association between KZT/USD movements and tradable CPI, with extensive time-series robustness/diagnostic checks but no explicit exogenous shock/IV/RCT identification.\n\n**Strengths**: The LP design with HAC inference and multiple stability/sensitivity diagnostics (bandwidth, lag/HAC sensitivity, regime stability, residual autocorrelation, leads test) supports that the estimated pass-through pattern is not an artifact of serial correlation, specification choice, or unstable regimes. The \u201cshock support\u201d and \u201csign consistency\u201d checks add credibility that the measured response is systematic in the data and not driven by a narrow subset of episodes.\n\n**Vulnerabilities**: Without an identification strategy for exchange-rate innovations (e.g., external instrument, high-frequency monetary surprise, commodity-driven terms-of-trade shock, or policy discontinuity), the KZT/USD change is likely endogenous to inflation news, monetary policy reactions, risk premia, and demand/supply shocks that also affect tradable prices, violating causal interpretation. Passing time-series diagnostics does not address omitted variable bias or simultaneity; the marginal significance (p\u22480.079) further suggests the estimate may be sensitive to remaining endogeneity or sampling variation.\n\n**Verdict**: **ABSENT**",
  "kzt_usd_to_cpi_nontradable": "**Strategy**: Reduced-form local projections estimating the dynamic response of non-tradable CPI to KZT/USD movements, relying on time-series robustness diagnostics rather than a source of exogenous variation.\n\n**Strengths**: A broad set of time-series diagnostics passes (residual autocorrelation checks, leads test, HAC sensitivity/bandwidth, lag sensitivity, regime stability, shock support), which supports internal validity of the *forecasting* relationship and reduces concerns that results are an artifact of specification, serial correlation, or unstable regimes. The estimate is statistically different from zero (p\u22480.023) but economically tiny, aligning with the stated falsification expectation (\u201cnear-zero pass-through\u201d to non-tradables).\n\n**Vulnerabilities**: There is explicitly no identification strategy (no IV, no natural experiment, no structural shock isolation), so KZT/USD is likely endogenous to domestic inflation conditions, monetary policy reactions, and common shocks (e.g., commodity prices), all of which can confound the edge. Even with leads tests and stability checks, reduced-form LPs do not rule out omitted time-varying confounders or simultaneity (exchange rate and prices co-moving due to shared drivers), so the causal interpretation is not secured.\n\n**Verdict**: **ABSENT**",
  "imported_inflation_instrument_to_real_income": "**Strategy**: No explicit identification strategy is provided; the edge is asserted based on an economic narrative that exchange-rate\u2013driven imported inflation reduces households\u2019 purchasing power and thus real income.\n\n**Strengths**: The proposed direction is economically coherent (higher consumer prices mechanically reduce real purchasing power holding nominal income fixed), and the \u201cimported inflation\u201d construct plausibly targets an external price component rather than purely domestic demand-driven inflation.\n\n**Vulnerabilities**: Without a design (e.g., IV, natural experiment, or quasi-exogenous shock) this is vulnerable to endogeneity and omitted variables: exchange-rate depreciation and imported inflation can coincide with broader macro shocks (recessions, wage dynamics, policy responses) that also directly affect real income. The term \u201cinstrument\u201d suggests IV use, but no first-stage/weak-IV diagnostics, exclusion restriction argument, or falsification/placebo tests are provided, so the causal pathway is not empirically isolated.\n\n**Verdict**: **ABSENT**",
  "cpi_headline_to_real_income": "**Strategy**: Local projections estimate the reduced-form dynamic association of headline CPI with subsequent real income, but no exogenous source of variation (shock/IV/RDD/RCT) is specified.\n\n**Strengths**: Passing HAC bandwidth/sensitivity and regime-stability diagnostics suggests inference is not overly sensitive to reasonable time-series HAC choices and that coefficients are not obviously driven by a single regime break. A reduced-form LP is an appropriate descriptive tool for tracing dynamics if the identifying shock were credibly exogenous.\n\n**Vulnerabilities**: With \u201cType: none,\u201d CPI movements are endogenous to macro conditions that also move real income (business cycle, monetary policy responses, demand shocks), so reverse causality and omitted-variable bias are first-order concerns; without a shock-based identification (e.g., external/imported inflation instrument, narrative shocks, high-frequency surprises), the edge is not causally pinned down. The failed **effective_obs** diagnostic further weakens credibility because small effective sample size (especially under serial correlation) can make HAC-based significance and stability checks unreliable; additionally, the reported estimate/SE of 0.0 provides no evidentiary content.\n\n**Verdict**: **ABSENT**",
  "imported_inflation_instrument_to_real_expenditure_negative": "**Strategy**: No identification strategy is provided; the edge asserts a negative causal effect of imported inflation on real expenditure based on narrative economic reasoning (sticky nominal incomes).\n\n**Strengths**: The sign is theoretically coherent: if nominal incomes are sticky in the short run, higher import prices raise the cost of consumption baskets and can reduce real purchasing power and real consumption. This mechanism is consistent with standard real-income/terms-of-trade channels in open-economy macro.\n\n**Vulnerabilities**: Without an exogenous source of variation in \u201cimported inflation,\u201d the relationship is highly confounded (e.g., global demand shocks, domestic monetary/fiscal responses, exchange-rate movements, and simultaneous recession dynamics can move both inflation and real spending). Reverse causality is also plausible: domestic demand conditions can affect exchange rates, pass-through, and measured import prices, and policy reactions can jointly determine inflation and consumption.\n\n**Verdict**: **ABSENT**",
  "transfer_income_to_nominal_income_buffering": "**Strategy**: Reduced-form local projections relating transfer income to nominal income dynamics, but with no stated source of exogenous variation (no shock/IV/RDD/RCT), so the edge rests on time-series association with HAC-based inference and stability checks.\n\n**Strengths**: Passing HAC bandwidth/sensitivity and regime-stability diagnostics suggests the estimated relationship is not purely an artifact of a particular lag/HAC choice or a single subsample regime. \u201cSign consistency\u201d (if genuinely pre-specified and not data-mined) provides some limited robustness against overfitting.\n\n**Vulnerabilities**: With identification explicitly listed as \u201cnone,\u201d the estimate is highly vulnerable to simultaneity and omitted variables (e.g., macro shocks that jointly move transfers and nominal income; policy reacting to income declines), plus reverse causality (transfers increasing when nominal income falls). The key failed diagnostic\u2014**effective_obs**\u2014directly undermines inferential credibility (likely too few effective observations due to autocorrelation/lag structure), and the reported estimate/SE of **0.0/0.0** with p=None is a red flag for estimation/recording issues that makes any causal interpretation untenable.\n\n**Verdict**: **ABSENT**",
  "real_income_to_cor_kspi": "**Strategy**: Reduced-form local projections of `cor_kspi` on innovations in `real_income`, relying on time-series dynamics/HAC inference rather than any explicit source of exogenous variation.\n\n**Strengths**: The diagnostics that did pass (HAC bandwidth choice, HAC sensitivity, regime stability, and sign consistency) suggest the time-series specification is not overly sensitive to standard inference/tuning choices and is not obviously driven by a single regime break. The hypothesized mechanism (income squeeze \u2192 repayment stress/provisions \u2192 balance-sheet pressure) is economically coherent.\n\n**Vulnerabilities**: Identification is essentially absent because the design explicitly lists \u201cType: none\u201d: real income movements are endogenous to macro/financial conditions that also directly affect Kaspi outcomes (simultaneity, omitted common shocks like monetary policy, commodity prices, FX/inflation surprises). The failed `effective_obs` diagnostic indicates insufficient effective sample size for reliable LP impulse estimates; combined with an estimate/SE reported as 0.0 and no p-value, the result is not empirically interpretable and could reflect estimation breakdown or data/standardization issues rather than a true null effect.\n\n**Verdict**: **ABSENT**",
  "vix_shock_to_deposit_cost_kspi": "**Strategy**: Reduced-form local projections of Kaspi deposit funding costs on a \u201cVIX shock,\u201d effectively treating innovations in VIX as an exogenous global risk-off shock with dynamic responses estimated via HAC-robust inference.\n\n**Strengths**: VIX is plausibly external to a single bank\u2019s deposit pricing in Kazakhstan and can proxy for global financial conditions, which supports a direction of influence. Several time-series diagnostics pass (HAC bandwidth/implementation, residual autocorrelation test, leads test, HAC sensitivity, and shock support), which reduces concerns about mechanical inference problems and obvious pre-trends.\n\n**Vulnerabilities**: The design lists no explicit identification strategy, so exogeneity is assumed rather than established; VIX innovations can be correlated with other concurrent global/regional shocks (commodity prices, FX/rate moves, Kazakhstan risk premium) that also affect deposit costs, creating omitted-variable bias. Two key stability checks fail (lag sensitivity and regime stability), indicating the impulse estimates are not robust to model specification and may differ across regimes; combined with an imprecise and statistically insignificant estimate (p\u22480.70), this weakens causal interpretability.\n\n**Verdict**: WEAK",
  "vix_shock_to_ppop_kspi": "**Strategy**: Reduced-form local projections estimating the dynamic response of `ppop_kspi` to a measured `vix_shock`, relying on the shock being effectively exogenous, but with no explicit identification (no IV, no narrative/external instrument, no quasi-experimental design).\n\n**Strengths**: Several time-series diagnostics passed (leads test, residual autocorrelation checks, HAC sensitivity, lag sensitivity, regime stability, and shock support), which supports that the estimated impulse response is not an artifact of a particular lag/HAC choice or obvious pre-trends. The sign consistency diagnostic and shock support suggest the series reacts in a directionally stable way and that there is variation in the shock over the sample.\n\n**Vulnerabilities**: The identification is fundamentally not established: VIX innovations can be correlated with contemporaneous global/macroeconomic news that also affects Kaspi\u2019s interest/profit margins (omitted variables/common shocks), so the reduced-form coefficient cannot be interpreted as causal without a defensible exogeneity argument. The key failure\u2014`effective_obs`\u2014raises concerns about small effective sample size (especially after lags/leads), making inference fragile; coupled with only marginal statistical significance (p \u2248 0.091), this weakens credibility and makes results sensitive to specification and finite-sample distortions.\n\n**Verdict**: ABSENT",
  "ppop_kspi_to_total_capital_kspi": "**Strategy**: No causal identification strategy is provided; the LOCAL_PROJECTIONS estimate is an associational time-series projection that may reflect accounting linkages rather than exogenous variation.\n\n**Strengths**: The edge is labeled \u201cmechanical,\u201d which can be appropriate if `ppop_kspi` is an accounting component that directly enters the construction of `total_capital_kspi` (e.g., profits flowing into retained earnings and thus regulatory capital), making the direction plausible. The estimate is precise (p\u22482e-16) and several time-series robustness diagnostics pass (HAC bandwidth choice, residual autocorrelation checks, HAC/lag sensitivity, regime stability, shock support, sign consistency), which supports statistical stability of the projection.\n\n**Vulnerabilities**: \u201cType: none\u201d means there is no exogenous shock, IV, discontinuity, or experimental variation isolating variation in `ppop_kspi`; thus the coefficient can be driven by common shocks (macro/credit cycle), simultaneous determination, or omitted variables affecting both profits/provisions and capital management. Two key diagnostics fail\u2014**effective_obs** (suggesting small effective sample / low independent information due to persistence) and **ts_leads_test** (failed pre-trend/lead test, implying anticipatory effects or reverse causality), both of which directly undermine causal timing and invalidate a causal interpretation even if the association is stable.\n\n**Verdict**: **ABSENT**",
  "rwa_kspi_to_k2_ratio_kspi": "**Strategy**: No causal identification\u2014this is a mechanical/accounting relationship where changes in RWA mechanically move the capital ratio \\(K2 = \\frac{\\text{Total Capital}}{\\text{RWA}}\\) holding the numerator fixed.\n\n**Strengths**: The sign and magnitude are directionally consistent with the identity (higher RWA lowers the ratio), and the result is statistically precise with extensive time-series robustness checks (HAC bandwidth, lag/HAC sensitivity, regime stability) passing.\n\n**Vulnerabilities**: Because the edge is an identity, the regression does not isolate an exogenous \u201cshock\u201d to RWA; movements in RWA are typically jointly determined with capital management and risk-taking, and the failed leads test flags predictive dynamics/incomplete shock isolation inconsistent with a clean local-projection causal shock. Any interpretation beyond arithmetic (e.g., \u201cRWA increases cause lower capital adequacy in a behavioral sense\u201d) is invalid without an external instrument or quasi-experiment.\n\n**Verdict**: **ABSENT**",
  "real_expenditure_to_ppop_kspi": "**Strategy**: Local projections are used to trace the reduced-form dynamic response of `ppop_kspi` to variation in `real_expenditure`, but no exogenous shock/IV/RCT-style source of variation is specified (effectively a time-series association).\n\n**Strengths**: Passing HAC bandwidth selection and HAC sensitivity checks suggests inference is at least robust to some choices of heteroskedasticity/autocorrelation correction. Regime-stability and sign-consistency diagnostics provide limited reassurance that the estimated relationship is not purely driven by a single subsample or a sign flip across specifications.\n\n**Vulnerabilities**: With \u201cType: none\u201d for identification, the key threat is endogeneity: `real_expenditure` likely responds contemporaneously to financial-sector conditions embedded in `ppop_kspi` (reverse causality) and to common macro shocks (omitted variables), so the LP coefficient is not interpretable as causal. Multiple failed diagnostics\u2014especially residual autocorrelation, lag sensitivity, shock support, and effective observations\u2014directly undermine internal validity (mis-specified dynamics, insufficient usable variation, and unstable impulse estimates), and the implausibly tiny SE relative to the point estimate is a red flag for numerical/estimation issues or unaccounted dependence.\n\n**Verdict**: **ABSENT**",
  "kzt_usd_to_imported_inflation_instrument": "**Strategy**: No causal identification is being claimed; this is an identity/construct edge where `imported_inflation_instrument` is mechanically derived from `kzt_usd` (auto-created from the IV construction).\n\n**Strengths**: If the instrument variable is explicitly defined as a deterministic function of `kzt_usd` (e.g., the FX rate itself or a component used in its calculation), then the relationship is tautologically true and does not require econometric identification.\n\n**Vulnerabilities**: This edge provides zero evidence that `kzt_usd` is exogenous with respect to the downstream outcome; any endogeneity of FX (policy responses, commodity shocks, capital flows) directly carries into the constructed instrument. If the \u201cidentity\u201d mapping is not exact (e.g., additional data sources, lags, transformations, or revisions), measurement error or undocumented processing could break the supposed determinism.\n\n**Verdict**: ABSENT",
  "e_import_share_to_imported_inflation_instrument": "**Strategy**: This edge is defined by an accounting identity: the \u201cimported_inflation_instrument\u201d is mechanically constructed as \\( \\Delta \\log(kzt\\_usd)\\times E\\_import\\_share\\), so \\(E\\_import\\_share\\) deterministically maps into the instrument.\n\n**Strengths**: Because it is a deterministic construction, there is no statistical identification problem for this mapping itself\u2014given the formula, changes in \\(E\\_import\\_share\\) translate one-for-one into the computed instrument holding the exchange-rate term fixed. Using *pre-period* import shares can reduce simultaneity with contemporaneous shocks (i.e., avoids using endogenous current shares).\n\n**Vulnerabilities**: This is not a causal relationship in the econometric sense; it\u2019s a definition, so it does not provide exogenous variation or a testable exclusion restriction relevant for downstream causal claims. If \u201cpre-period\u201d shares are not truly predetermined (e.g., influenced by anticipatory behavior, policy, or earlier trends correlated with outcomes), then even the intended interpretation of the instrument as exogenous \u201cexposure\u201d can be compromised in subsequent stages.\n\n**Verdict**: **ABSENT**",
  "total_capital_kspi_to_k2_ratio_kspi": "**Strategy**: Uses an accounting/regulatory identity (K2 ratio is defined as Total Capital divided by RWA), treating the edge as mechanically implied rather than causally estimated.\n\n**Strengths**: The mapping from Total Capital to the K2 ratio is structurally grounded in the Basel/regulatory definition, so directionality is not a behavioral causal claim but a definitional relationship. Several time-series diagnostics (HAC bandwidth/robustness, effective observations, residual autocorrelation checks, shock support) suggest the LP implementation is not obviously driven by basic inference artifacts.\n\n**Vulnerabilities**: The empirical LP estimate is essentially null and very imprecise (\u22120.0053, SE 0.0157, p=0.74), which is inconsistent with a stable mechanical relationship unless RWA moves endogenously in ways that offset capital changes; that means the \u201ceffect\u201d of capital on the ratio is not identified without modeling/conditioning on RWA. Diagnostics failing on leads, lag sensitivity, and regime stability directly undermine the key assumption that the definitional mapping is stable over time and that the dynamic specification is correctly capturing the identity (suggesting structural breaks, changing measurement, or shifting regulatory/reporting regimes).\n\n**Verdict**: WEAK",
  "nominal_expenditure_to_real_expenditure": "**Strategy**: Treat the edge as an accounting/measurement identity: real_expenditure is mechanically constructed from nominal_expenditure (deflated by CPI), so the mapping is definitional rather than estimated causal variation.\n\n**Strengths**: Because real_expenditure is computed directly from nominal_expenditure (and CPI), there is no confounding in the usual sense\u2014changes in nominal_expenditure translate one-for-one into changes in the constructed real measure holding the deflator fixed. The \u201cestimate 0.0 (SE 0.0)\u201d is consistent with this being a formula component rather than an econometric relationship, and standard LP diagnostics (HAC bandwidth, stability/sensitivity checks) are largely irrelevant to identification of a definitional link.\n\n**Vulnerabilities**: The key threat is mismeasurement/construct validity: CPI_headline may be an inappropriate deflator for household consumption (substitution bias, quality adjustment, household-specific inflation, mismatch with the consumption basket), which would make \u201creal_expenditure\u201d a noisy or biased proxy for true real consumption. The failed **effective_obs** diagnostic raises concerns about whether the time-series setup has enough usable variation/observations for the LP machinery, but more importantly it underscores that statistical inference here doesn\u2019t meaningfully validate the identity.\n\n**Verdict**: MODERATE",
  "cpi_headline_to_real_expenditure": "**Strategy**: No causal identification\u2014this is an auto-created \u201cidentity\u201d edge estimated via reduced-form local projections without an exogenous shock, instrument, or experimental variation.\n\n**Strengths**: The time-series diagnostics that passed (HAC bandwidth/effective obs, leads test, residual autocorrelation checks, HAC sensitivity, and shock support) support that the LP is mechanically implementable and not obviously driven by simple serial-correlation artifacts. As an \u201cidentity\u201d relation, a contemporaneous link could be conceptually grounded if real expenditure is constructed using CPI (deflation), but that would be a definitional mapping rather than an estimated causal effect.\n\n**Vulnerabilities**: With \u201cType: none\u201d and no identifying assumption, the LP coefficient is purely associational and vulnerable to simultaneity (expenditure can affect prices), omitted variables (aggregate demand/supply shocks moving both), and policy responses. Two key robustness checks fail\u2014lag sensitivity and regime stability\u2014indicating the estimate is not stable to specification/period changes; combined with an imprecise, insignificant estimate (0.87 with SE 1.89, p=0.65), this undermines any causal interpretation.\n\n**Verdict**: **ABSENT**",
  "nominal_income_to_real_income": "**Strategy**: This edge is an accounting/definitional identity (real income is mechanically derived from nominal income and a price deflator), not a causally identified effect using exogenous variation.\n\n**Strengths**: As an identity, the direction and sign are structurally implied by the construction of the variables, and the estimate is extremely precise (SE \u2248 0.028, p \u2248 0). Many time-series diagnostics (HAC bandwidth adequacy, effective observations, residual autocorrelation checks, HAC/lag sensitivity, regime stability, and shock support) suggest the local-projection fit is statistically stable.\n\n**Vulnerabilities**: There is no identification design (no experiment/quasi-experiment/IV), so the coefficient cannot be interpreted as a causal response of \u201creal income\u201d to an exogenous change in \u201cnominal income\u201d holding the deflator fixed\u2014real income is jointly determined by nominal income and prices. The failed **ts_leads_test** indicates evidence consistent with anticipation/reverse timing (future nominal income predicting current real income), which is a red flag for interpreting the LP estimate as a causal impulse response even if one were attempted.\n\n**Verdict**: **ABSENT**",
  "cor_kspi_to_total_capital_kspi": "",
  "cpi_nontradable_to_cpi_headline": "**Strategy**: None\u2014this edge is treated as an \u201cidentity\u201d link and is empirically proxied with a local-projections association that was auto-bridged via tag similarity rather than a defined shock/IV/RCT.\n\n**Strengths**: As a matter of accounting, headline CPI is mechanically a weighted aggregation of subcomponents (tradable/non-tradable), so a positive relationship is structurally expected; the estimate is statistically significant and several time-series robustness checks (HAC sensitivity, lag sensitivity, regime stability, residual autocorrelation) reportedly pass.\n\n**Vulnerabilities**: The identification is not causal: local projections here do not isolate exogenous variation in non-tradable CPI, and the \u201cauto-bridged\u201d construction indicates the variables were linked by semantic similarity rather than a verified measurement identity (i.e., confirmed CPI weights and formula). The failed **ts_leads_test** is a red flag for reverse timing/anticipation (headline moving before \u201cnon-tradable\u201d in the LP), inconsistent with a clean causal ordering and suggestive of simultaneity/common shocks or measurement/aggregation issues.\n\n**Verdict**: **ABSENT**",
  "cpi_tradable_to_cpi_headline": "**Strategy**: None\u2014this edge is auto-bridged via tag similarity and then estimated with local projections, so it amounts to a predictive association rather than an identified causal effect (despite being labeled \u201cidentity\u201d).\n\n**Strengths**: The LP estimate is very precise (0.762, SE 0.043, extremely small p-value) and many time-series robustness checks pass (HAC bandwidth/effective obs, residual autocorrelation check, HAC/lag sensitivity, regime stability, shock support, sign consistency), suggesting the relationship is stable and not an artifact of a particular specification.\n\n**Vulnerabilities**: There is no source of exogenous variation and no stated identifying assumption; headline CPI mechanically co-moves with tradable CPI through index construction and shared shocks, so the coefficient is not interpretable as a causal effect without a structural decomposition/weighting identity. The failed **ts_leads_test** is a red flag for reverse timing/anticipation (headline moving before tradables), which directly undermines a causal \u201ctradables \u2192 headline\u201d interpretation even in a reduced-form sense.\n\n**Verdict**: **ABSENT**"
};

// ── Helpers ──────────────────────────────────────────────────────────────
function escHtml(s) {
    if (!s) return '';
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

var PROVENANCE_LABELS = {
    'manual': 'Manual',
    'paper_scout': 'PaperScout',
    'data_scout': 'DataScout',
    'discovery_agent': 'Discovery'
};

function provenanceBadge(src) {
    if (!src) return '';
    var label = PROVENANCE_LABELS[src] || src;
    return '<span class="provenance-badge ' + escHtml(src) + '">' + escHtml(label) + '</span>';
}

function renderMarkdown(s) {
    if (!s) return '';
    var h = escHtml(s);
    // Bold: **text** or __text__
    h = h.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    h = h.replace(/__(.+?)__/g, '<strong>$1</strong>');
    // Italic: *text* or _text_ (but not inside already-converted strong)
    h = h.replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '<em>$1</em>');
    h = h.replace(/(?<!_)_(?!_)(.+?)(?<!_)_(?!_)/g, '<em>$1</em>');
    // Inline code: `text`
    h = h.replace(/`([^`]+)`/g, '<code style="background:#e8e8e8;padding:1px 3px;font-size:9px;">$1</code>');
    // Bullet lists: lines starting with - or *
    h = h.replace(/^[\-\*]\s+(.+)$/gm, '<li>$1</li>');
    h = h.replace(/((?:<li>.*<\/li>\s*)+)/g, '<ul style="margin:4px 0 4px 16px;padding:0;">$1</ul>');
    // Numbered lists: lines starting with 1. 2. etc
    h = h.replace(/^\d+\.\s+(.+)$/gm, '<li>$1</li>');
    // Line breaks: double newline -> paragraph break, single newline -> <br>
    h = h.replace(/\n\n+/g, '</p><p style="margin:4px 0;">');
    h = h.replace(/\n/g, '<br>');
    h = '<p style="margin:4px 0;">' + h + '</p>';
    return h;
}

function renderGuidanceSections(s) {
    if (!s) return '';
    // Split into Finding / Concern / Recommendation sections
    var sections = [
        {key: 'finding', re: /\*\*Finding\*\*:\s*/i},
        {key: 'concern', re: /\*\*Concern\*\*:\s*/i},
        {key: 'recommendation', re: /\*\*Recommendation\*\*:\s*/i}
    ];
    // Find section boundaries
    var parts = [];
    var text = s;
    var indices = [];
    sections.forEach(function(sec) {
        var m = text.match(sec.re);
        if (m) indices.push({key: sec.key, idx: text.indexOf(m[0]), len: m[0].length, label: sec.key.charAt(0).toUpperCase() + sec.key.slice(1)});
    });
    indices.sort(function(a, b) { return a.idx - b.idx; });

    if (indices.length === 0) {
        // No structured sections found, fall back to plain markdown
        return renderMarkdown(s);
    }

    var html = '';
    for (var i = 0; i < indices.length; i++) {
        var start = indices[i].idx + indices[i].len;
        var end = (i + 1 < indices.length) ? indices[i + 1].idx : text.length;
        var body = text.substring(start, end).trim();
        html += '<div class="pd-section ' + indices[i].key + '">' +
            '<div class="pd-section-label">' + escHtml(indices[i].label) + '</div>' +
            renderMarkdown(body) +
            '</div>';
    }
    return html;
}

function formatBeta(beta) {
    if (beta === null || beta === undefined) return '--';
    if (beta === 0) return '0';
    var abs = Math.abs(beta);
    if (abs >= 10000) return (beta / 1000).toFixed(0) + 'k';
    if (abs >= 1000) return (beta / 1000).toFixed(1) + 'k';
    if (abs >= 100) return beta.toFixed(0);
    if (abs >= 10) return beta.toFixed(1);
    if (abs >= 1) return beta.toFixed(1);
    if (abs >= 0.01) return beta.toFixed(2);
    if (abs >= 0.001) return beta.toFixed(3);
    return beta.toExponential(1);
}
function fmtP(p) {
    if (p === null || p === undefined) return '--';
    if (p < 0.0001) return p.toExponential(2);
    return p.toFixed(4);
}

function getEdgeColor(d) {
    var isNull = d.pvalue !== null && d.pvalue !== undefined && d.pvalue >= 0.05;
    if (isNull) return '#999';
    return EDGE_TYPE_COLORS[d.edge_type] || '#2563eb';
}
function isEdgeNull(d) {
    return d.pvalue !== null && d.pvalue !== undefined && d.pvalue >= 0.05;
}

// ── Decision state ───────────────────────────────────────────────────────
var decisions = {}; // issue_key -> {value, rationale}

// Flatten all issues across edges for the sidebar
var allIssues = [];
var SEVERITY_ORDER = {CRITICAL: 0, HIGH: 1, MEDIUM: 2, LOW: 3};
EDGES.forEach(function(e) {
    if (e.issues && e.issues.length > 0) {
        e.issues.forEach(function(issue) {
            allIssues.push({
                edge_id: e.id,
                issue_key: issue.issue_key || (issue.rule_id + ':' + e.id),
                rule_id: issue.rule_id,
                severity: issue.severity,
                message: issue.message
            });
        });
    }
});
allIssues.sort(function(a, b) {
    var sa = SEVERITY_ORDER[a.severity] || 99;
    var sb = SEVERITY_ORDER[b.severity] || 99;
    if (sa !== sb) return sa - sb;
    return a.edge_id.localeCompare(b.edge_id);
});
var totalIssues = allIssues.length;

function countResolved() {
    var c = 0;
    for (var k in decisions) {
        if (decisions[k] && decisions[k].value) c++;
    }
    return c;
}

function updateProgress() {
    var resolved = countResolved();
    var pct = totalIssues > 0 ? (resolved / totalIssues * 100) : 0;
    document.getElementById('pitfallProgressFill').style.width = pct + '%';
    document.getElementById('pitfallProgressLabel').textContent = resolved + ' / ' + totalIssues + ' resolved';
}

// ── Setup ────────────────────────────────────────────────────────────────
document.getElementById('dagSubtitle').textContent =
    NODES.length + ' nodes, ' + EDGES.length + ' edges';
document.getElementById('statNodes').textContent = NODES.length;

// Compute node layers via topological distance from roots
var inDegree = {};
NODES.forEach(function(n) { inDegree[n.id] = 0; });
EDGES.forEach(function(e) { inDegree[e.target] = (inDegree[e.target] || 0) + 1; });

var layers = {};
var visited = {};
function computeLayer(nodeId) {
    if (visited[nodeId]) return layers[nodeId] || 0;
    visited[nodeId] = true;
    var incoming = EDGES.filter(function(e) { return e.target === nodeId; });
    if (incoming.length === 0) { layers[nodeId] = 0; return 0; }
    var maxParent = 0;
    incoming.forEach(function(e) {
        var pLayer = computeLayer(e.source);
        if (pLayer + 1 > maxParent) maxParent = pLayer + 1;
    });
    layers[nodeId] = maxParent;
    return maxParent;
}
NODES.forEach(function(n) { computeLayer(n.id); });
NODES.forEach(function(n) { n.layer = layers[n.id] || 0; });

// Populate type filter
var typeSet = {};
EDGES.forEach(function(e) { typeSet[e.edge_type || 'causal'] = true; });
var typeFilter = document.getElementById('typeFilter');
Object.keys(typeSet).sort().forEach(function(t) {
    var opt = document.createElement('option');
    opt.value = t;
    opt.textContent = EDGE_TYPE_LABELS[t] || t;
    typeFilter.appendChild(opt);
});

// Build legend
var legendContainer = document.getElementById('legendContainer');
Object.keys(typeSet).sort().forEach(function(t) {
    var color = EDGE_TYPE_COLORS[t] || '#2563eb';
    var div = document.createElement('div');
    div.className = 'legend-item';
    div.innerHTML = '<div class="legend-line" style="background:' + color + '"></div>' +
        (EDGE_TYPE_LABELS[t] || t);
    legendContainer.appendChild(div);
});
var nullLeg = document.createElement('div');
nullLeg.className = 'legend-item';
nullLeg.innerHTML = '<div class="legend-line dashed" style="border-color:#999"></div>Null / Insig.';
legendContainer.appendChild(nullLeg);

// ── Build pitfall sidebar ────────────────────────────────────────────────
var pitfallList = document.getElementById('pitfallList');

if (allIssues.length === 0) {
    pitfallList.innerHTML = '<div class="pitfall-empty">No open issues.</div>';
} else {
    allIssues.forEach(function(issue) {
        var ruleInfo = RULE_DESCRIPTIONS[issue.rule_id] || {};
        var actCfg = ACTIONS_BY_RULE[issue.rule_id] || ACTIONS_BY_RULE['_default'] || {};
        var options = actCfg.options || [];

        var div = document.createElement('div');
        div.className = 'pitfall-item';
        div.setAttribute('data-issue-key', issue.issue_key);
        div.setAttribute('data-edge-id', issue.edge_id);

        // Build options HTML
        var optHtml = '<option value="">-- select action --</option>';
        options.forEach(function(o) {
            optHtml += '<option value="' + escHtml(o.value) + '" data-tooltip="' + escHtml(o.tooltip || '') + '">' + escHtml(o.label) + '</option>';
        });

        var llmText = ISSUE_GUIDANCE[issue.issue_key] || '';
        var llmHtml = llmText ?
            '<div class="pd-llm-guidance"><div class="pd-llm-guidance-title">AI Analysis</div>' +
            renderGuidanceSections(llmText) + '</div>' : '';

        // Build static text (Why it matters + Decision guidance)
        var staticHtml = '';
        if (ruleInfo.explanation || ruleInfo.guidance) {
            var staticContent =
                (ruleInfo.explanation ? '<div class="pd-label">Why it matters:</div><div class="pd-text">' + ruleInfo.explanation + '</div>' : '') +
                (ruleInfo.guidance ? '<div class="pd-label">Decision guidance:</div><div class="pd-guidance">' + ruleInfo.guidance + '</div>' : '');
            if (llmText) {
                // Collapse when AI Analysis is present
                staticHtml = '<details class="pd-static-ref"><summary>Reference</summary>' + staticContent + '</details>';
            } else {
                staticHtml = staticContent;
            }
        }

        // Strategy tag and verdict badge for pitfall items
        var edgeObj = EDGES.find(function(e2) { return e2.id === issue.edge_id; });
        var stratTag = (edgeObj && edgeObj.strategy_type) ?
            '<span class="strategy-tag">' + escHtml(edgeObj.strategy_type.replace(/_/g, ' ')) + '</span>' : '';
        var provBadge = (edgeObj && edgeObj.provenance_source) ? provenanceBadge(edgeObj.provenance_source) : '';
        var caText = (edgeObj && edgeObj.causal_assessment) ? edgeObj.causal_assessment :
            (CAUSAL_ASSESSMENTS[issue.edge_id] || '');
        var verdict = extractVerdict(caText);
        var verdictBadge = verdict ?
            '<span class="id-badge ' + verdict + '">' + verdict + '</span>' : '';
        var caHtml = caText ?
            '<div class="causal-assessment"><div class="causal-assessment-title">Causal Assessment</div>' +
            renderCausalAssessment(caText) + '</div>' : '';

        div.innerHTML =
            '<div class="pitfall-item-header" data-header="1">' +
                '<span class="pitfall-edge">' + escHtml(issue.edge_id) + '</span>' +
                '<span class="pitfall-severity ' + issue.severity + '">' + issue.severity + '</span>' +
                verdictBadge + provBadge + stratTag +
                '<span class="pitfall-resolved-check">&#10003;</span>' +
            '</div>' +
            '<div class="pitfall-msg">' + escHtml(issue.message) + '</div>' +
            '<div class="pitfall-decision" data-decision-key="' + escHtml(issue.issue_key) + '">' +
                llmHtml +
                caHtml +
                staticHtml +
                '<div class="pd-label">Action:</div>' +
                '<select data-key="' + escHtml(issue.issue_key) + '">' + optHtml + '</select>' +
                '<div class="pd-tooltip-area" data-tip-for="' + escHtml(issue.issue_key) + '"></div>' +
                '<input type="text" data-rationale="' + escHtml(issue.issue_key) + '" placeholder="Justification (optional)...">' +
                '<div class="pd-buttons">' +
                    '<button class="pd-btn pd-btn-confirm" data-confirm="' + escHtml(issue.issue_key) + '">Confirm</button>' +
                    '<button class="pd-btn" data-defer="' + escHtml(issue.issue_key) + '">Defer</button>' +
                '</div>' +
            '</div>';

        pitfallList.appendChild(div);
    });
}

// ── Add clean-edge entries (edges without issues) ────────────────────────
var edgesWithIssues = {};
allIssues.forEach(function(i) { edgesWithIssues[i.edge_id] = true; });

var cleanEdges = EDGES.filter(function(e) { return !edgesWithIssues[e.id]; });
if (cleanEdges.length > 0) {
    var divider = document.createElement('div');
    divider.className = 'pitfall-divider';
    divider.textContent = 'Assessed Edges (' + cleanEdges.length + ')';
    pitfallList.appendChild(divider);

    cleanEdges.forEach(function(edge) {
        var div = document.createElement('div');
        div.className = 'pitfall-item clean-edge';
        div.setAttribute('data-edge-id', edge.id);

        var ratingHtml = edge.rating ? '<span class="pitfall-rating">' + escHtml(edge.rating) + '</span>' : '';
        var statsHtml = '';
        if (edge.point !== null && edge.point !== undefined) {
            statsHtml = '<div class="pitfall-stats">' +
                '\u03B2=' + formatBeta(edge.point) +
                (edge.pvalue !== null && edge.pvalue !== undefined ? '  p=' + fmtP(edge.pvalue) : '') +
                (edge.design ? '  ' + escHtml(edge.design) : '') +
                '</div>';
        }

        var annText = edge.llm_annotation || '';
        var annHtml = annText ?
            '<div class="pd-llm-guidance"><div class="pd-llm-guidance-title">AI Analysis</div>' +
            renderMarkdown(annText) + '</div>' : '';

        // Strategy tag, provenance badge, and verdict badge for clean edges
        var cleanStratTag = edge.strategy_type ?
            '<span class="strategy-tag">' + escHtml(edge.strategy_type.replace(/_/g, ' ')) + '</span>' : '';
        var cleanProvBadge = edge.provenance_source ? provenanceBadge(edge.provenance_source) : '';
        var cleanCaText = edge.causal_assessment || CAUSAL_ASSESSMENTS[edge.id] || '';
        var cleanVerdict = extractVerdict(cleanCaText);
        var cleanVerdictBadge = cleanVerdict ?
            '<span class="id-badge ' + cleanVerdict + '">' + cleanVerdict + '</span>' : '';
        var cleanCaHtml = cleanCaText ?
            '<div class="causal-assessment"><div class="causal-assessment-title">Causal Assessment</div>' +
            renderCausalAssessment(cleanCaText) + '</div>' : '';

        div.innerHTML =
            '<div class="pitfall-item-header" data-header="1">' +
                '<span class="pitfall-edge">' + escHtml(edge.id) + '</span>' +
                ratingHtml + cleanVerdictBadge + cleanProvBadge + cleanStratTag +
            '</div>' +
            statsHtml +
            '<div class="pitfall-decision" data-decision-key="edge:' + escHtml(edge.id) + '">' +
                annHtml +
                cleanCaHtml +
            '</div>';

        pitfallList.appendChild(div);
    });
}

updateProgress();

// ── Click-to-highlight + expand ──────────────────────────────────────────
var currentHighlightEdge = null;

function highlightEdge(edgeId) {
    // Remove previous highlight
    links.classed('highlighted', false);
    // Apply highlight to matching link
    links.each(function(d) {
        if (d.id === edgeId) {
            d3.select(this).classed('highlighted', true);
        }
    });
    currentHighlightEdge = edgeId;

    // Pan/zoom to edge midpoint
    var edgeData = EDGES.find(function(e) { return e.id === edgeId; });
    if (edgeData && edgeData.source && edgeData.target) {
        var sx = edgeData.source.x || edgeData.source;
        var sy = edgeData.source.y || edgeData.source;
        var tx = edgeData.target.x || edgeData.target;
        var ty = edgeData.target.y || edgeData.target;
        if (typeof sx === 'number' && typeof tx === 'number') {
            var mx = (sx + tx) / 2;
            var my = (sy + ty) / 2;
            var svgEl = document.getElementById('graph');
            var w = svgEl.clientWidth;
            var h = svgEl.clientHeight;
            var t = d3.zoomIdentity.translate(w/2 - mx, h/2 - my);
            svg.transition().duration(500).call(zoomBehavior.transform, t);
        }
    }
}

function markEdgeResolved(edgeId) {
    // Check if ALL issues for this edge are resolved
    var edgeIssues = allIssues.filter(function(i) { return i.edge_id === edgeId; });
    var allResolved = edgeIssues.every(function(i) {
        return decisions[i.issue_key] && decisions[i.issue_key].value;
    });
    if (allResolved) {
        links.each(function(d) {
            if (d.id === edgeId) {
                d3.select(this).classed('edge-resolved', true).classed('critical-issue', false).classed('highlighted', false);
            }
        });
    }
}

// Event delegation on pitfall list
pitfallList.addEventListener('click', function(e) {
    var target = e.target;

    // Confirm button
    if (target.hasAttribute('data-confirm')) {
        e.stopPropagation();
        var key = target.getAttribute('data-confirm');
        if (!decisions[key] || !decisions[key].value) {
            alert('Please select an action before confirming.');
            return;
        }
        var item = pitfallList.querySelector('[data-issue-key="' + key + '"]');
        if (item) {
            item.classList.add('resolved');
            var sel = item.querySelector('select[data-key="' + key + '"]');
            if (sel) sel.classList.add('decided');
        }
        var edgeId = null;
        allIssues.forEach(function(i) { if (i.issue_key === key) edgeId = i.edge_id; });
        if (edgeId) markEdgeResolved(edgeId);
        updateProgress();
        return;
    }

    // Defer button
    if (target.hasAttribute('data-defer')) {
        e.stopPropagation();
        var key2 = target.getAttribute('data-defer');
        var item2 = pitfallList.querySelector('[data-issue-key="' + key2 + '"]');
        if (item2) {
            item2.classList.remove('active');
            var panel = item2.querySelector('.pitfall-decision');
            if (panel) panel.classList.remove('open');
        }
        links.classed('highlighted', false);
        return;
    }

    // Don't toggle when clicking inside decision panel controls
    if (target.tagName === 'SELECT' || target.tagName === 'INPUT' || target.tagName === 'OPTION') return;

    // Find the pitfall-item
    var pitfallItem = target.closest('.pitfall-item');
    if (!pitfallItem) return;

    // Toggle active state
    var wasActive = pitfallItem.classList.contains('active');

    // Deactivate all
    pitfallList.querySelectorAll('.pitfall-item').forEach(function(el) {
        el.classList.remove('active');
        var p = el.querySelector('.pitfall-decision');
        if (p) p.classList.remove('open');
    });
    links.classed('highlighted', false);

    if (!wasActive) {
        pitfallItem.classList.add('active');
        var decPanel = pitfallItem.querySelector('.pitfall-decision');
        if (decPanel) decPanel.classList.add('open');
        var eid = pitfallItem.getAttribute('data-edge-id');
        if (eid) highlightEdge(eid);
    }
});

// Action dropdown change
pitfallList.addEventListener('change', function(e) {
    if (e.target.tagName !== 'SELECT' || !e.target.hasAttribute('data-key')) return;
    var key = e.target.getAttribute('data-key');
    var val = e.target.value;
    if (!decisions[key]) decisions[key] = {value: '', rationale: ''};
    decisions[key].value = val;

    if (val) {
        e.target.classList.add('decided');
    } else {
        e.target.classList.remove('decided');
    }

    // Show tooltip for selected option
    var tipArea = pitfallList.querySelector('[data-tip-for="' + key + '"]');
    if (tipArea) {
        var selectedOpt = e.target.options[e.target.selectedIndex];
        tipArea.textContent = selectedOpt ? (selectedOpt.getAttribute('data-tooltip') || '') : '';
    }
});

// Rationale input
pitfallList.addEventListener('input', function(e) {
    if (e.target.tagName !== 'INPUT' || !e.target.hasAttribute('data-rationale')) return;
    var key = e.target.getAttribute('data-rationale');
    if (!decisions[key]) decisions[key] = {value: '', rationale: ''};
    decisions[key].rationale = e.target.value;
});

// ── Export ────────────────────────────────────────────────────────────────
document.getElementById('exportBtn').addEventListener('click', function() {
    var analystId = document.getElementById('analystId').value.trim();
    var now = new Date().toISOString();
    var decisionList = [];

    for (var key in decisions) {
        var dec = decisions[key];
        if (!dec.value) continue;
        var parts = key.split(':', 1);
        var ruleId = parts[0] || '';
        var edgeId = key.substring(ruleId.length + 1);
        var actCfg = ACTIONS_BY_RULE[ruleId] || ACTIONS_BY_RULE['_default'] || {};
        decisionList.push({
            issue_key: key,
            edge_id: edgeId,
            rule_id: ruleId,
            action: actCfg.action_type || 'unknown',
            value: dec.value,
            rationale: dec.rationale || '',
            status: 'CLOSED',
            source: 'dag_visualization'
        });
    }

    var output = {
        generated_at: now,
        analyst_id: analystId || 'anonymous',
        panel_built_at: GENERATED_AT,
        decisions: decisionList
    };

    var blob = new Blob([JSON.stringify(output, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    var dateStr = now.slice(0,10).replace(/-/g,'');
    a.href = url;
    a.download = 'dag_viz_decisions_' + dateStr + '.json';
    a.click();
    URL.revokeObjectURL(url);
});

// ── D3 Graph ─────────────────────────────────────────────────────────────
var svg = d3.select('#graph');
var width = window.innerWidth;
var height = window.innerHeight;
svg.attr('width', width).attr('height', height);

// Arrow markers
var defs = svg.append('defs');
var defaultColors = Object.values(EDGE_TYPE_COLORS).concat(['#999']);
var colorSet = {};
defaultColors.forEach(function(c) { colorSet[c] = true; });
Object.keys(colorSet).forEach(function(color) {
    defs.append('marker')
        .attr('id', 'arrow-' + color.replace('#', ''))
        .attr('viewBox', '0 -3 6 6')
        .attr('refX', 18)
        .attr('refY', 0)
        .attr('markerWidth', 5)
        .attr('markerHeight', 5)
        .attr('orient', 'auto')
        .append('path')
        .attr('d', 'M0,-3L6,0L0,3')
        .attr('fill', color);
});

var g = svg.append('g');
var zoomBehavior = d3.zoom().scaleExtent([0.3, 3]).on('zoom', function(e) { g.attr('transform', e.transform); });
svg.call(zoomBehavior);

var simulation = d3.forceSimulation(NODES)
    .force('link', d3.forceLink(EDGES).id(function(d) { return d.id; }).distance(120).strength(0.3))
    .force('charge', d3.forceManyBody().strength(-400))
    .force('center', d3.forceCenter(width / 2, height / 2))
    .force('y', d3.forceY(function(d) { return 80 + d.layer * 90; }).strength(0.7))
    .force('x', d3.forceX(width / 2).strength(0.02))
    .force('collision', d3.forceCollide(40));

var linkGroup = g.append('g');
var links = linkGroup.selectAll('path')
    .data(EDGES)
    .enter()
    .append('path')
    .attr('class', function(d) { return 'link' + (isEdgeNull(d) ? ' null' : '') + (d.has_critical_issue ? ' critical-issue' : ''); })
    .attr('stroke', function(d) { return getEdgeColor(d); })
    .attr('stroke-width', function(d) { return d.pvalue !== null && d.pvalue < 0.05 ? 2.5 : 1.5; })
    .attr('marker-end', function(d) { return 'url(#arrow-' + getEdgeColor(d).replace('#', '') + ')'; })
    .on('mouseover', showEdgeTooltip)
    .on('mouseout', hideTooltip);

var labelGroup = g.append('g');
var labelBgs = labelGroup.selectAll('rect')
    .data(EDGES)
    .enter()
    .append('rect')
    .attr('class', 'label-bg')
    .attr('rx', 2)
    .attr('ry', 2);

var linkLabels = labelGroup.selectAll('text')
    .data(EDGES)
    .enter()
    .append('text')
    .attr('class', 'link-label')
    .text(function(d) { return formatBeta(d.point); });

var nodeGroup = g.append('g');
var node = nodeGroup.selectAll('g')
    .data(NODES)
    .enter()
    .append('g')
    .attr('class', 'node')
    .call(d3.drag()
        .on('start', function(e, d) { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
        .on('drag', function(e, d) { d.fx = e.x; d.fy = e.y; })
        .on('end', function(e, d) { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; }))
    .on('mouseover', showNodeTooltip)
    .on('mouseout', hideTooltip);

// Check if node has ID risks from any edge
var nodeIdRisks = {};
EDGES.forEach(function(e) {
    if (e.id_risks && Object.keys(e.id_risks).length > 0) {
        nodeIdRisks[e.source] = true;
        nodeIdRisks[e.target] = true;
    }
});

node.append('circle')
    .attr('r', 18)
    .attr('class', function(d) {
        var cls = '';
        if (d.latent) cls += ' latent';
        if (d.orphan) cls += ' orphan';
        if (nodeIdRisks[d.id]) cls += ' id-risk';
        return cls;
    });
node.append('text').attr('dy', 4).text(function(d) { return d.label; });

var tooltip = d3.select('#tooltip');

function showEdgeTooltip(e, d) {
    var html = '<h3>' + d.source.id.replace(/_/g, ' ') + ' &rarr; ' + d.target.id.replace(/_/g, ' ') + '</h3>';
    html += '<div class="tooltip-row"><span class="tooltip-label">Edge ID</span><span class="tooltip-value">' + d.id + '</span></div>';
    html += '<div class="tooltip-row"><span class="tooltip-label">Type</span><span class="tooltip-value">' + (EDGE_TYPE_LABELS[d.edge_type] || d.edge_type) + '</span></div>';
    var hasEstimate = (d.point !== null && d.point !== undefined) || d.design;
    if (d.point !== null && d.point !== undefined) {
        html += '<div class="tooltip-row"><span class="tooltip-label">&beta;</span><span class="tooltip-value">' + d.point.toFixed(4) + '</span></div>';
    }
    if (d.se !== null && d.se !== undefined) {
        html += '<div class="tooltip-row"><span class="tooltip-label">SE</span><span class="tooltip-value">' + d.se.toFixed(4) + '</span></div>';
    }
    if (d.pvalue !== null && d.pvalue !== undefined) {
        html += '<div class="tooltip-row"><span class="tooltip-label">p-value</span><span class="tooltip-value ' + (isEdgeNull(d) ? 'null' : '') + '">' + fmtP(d.pvalue) + '</span></div>';
    }
    if (d.claim_level) html += '<div class="tooltip-row"><span class="tooltip-label">Claim</span><span class="tooltip-value">' + d.claim_level + '</span></div>';
    if (d.rating) html += '<div class="tooltip-row"><span class="tooltip-label">Rating</span><span class="tooltip-value">' + d.rating + '</span></div>';
    if (d.design) html += '<div class="tooltip-row"><span class="tooltip-label">Design</span><span class="tooltip-value">' + d.design + '</span></div>';
    if (d.design === 'DATA_INSUFFICIENT') {
        html += '<div style="margin-top:8px;padding:6px 8px;background:#f8d7da;border:1px solid #f5c2c7;border-radius:4px;font-size:10px">';
        html += '<div style="font-weight:600;color:#842029;margin-bottom:4px">Insufficient Data</div>';
        html += '<div style="color:#842029;margin-bottom:4px">This edge has fewer than 5 overlapping observations after data alignment. No reliable estimate can be produced.</div>';
        var ffList = d.failure_flags || [];
        if (ffList.indexOf('data_insufficient') >= 0) {
            html += '<div style="color:#555;margin-top:4px"><strong>Common causes:</strong> Date format mismatch between series, missing time periods in downloaded data, or derived node dependencies that fail to compute.</div>';
        }
        if (d.blocked_reason) html += '<div style="color:#555;margin-top:4px">' + escHtml(d.blocked_reason) + '</div>';
        if (d.remediation) html += '<div style="color:#555;margin-top:4px">' + escHtml(d.remediation) + '</div>';
        html += '</div>';
    } else if (!hasEstimate) {
        html += '<div style="margin-top:8px;padding:6px 8px;background:#fff3cd;border:1px solid #ffc107;border-radius:4px;font-size:10px">';
        html += '<div style="font-weight:600;color:#856404;margin-bottom:4px">Not Estimated</div>';
        if (d.blocked_reason) {
            html += '<div style="color:#856404;margin-bottom:4px">' + escHtml(d.blocked_reason) + '</div>';
        }
        if (d.remediation) {
            html += '<div style="color:#555">' + escHtml(d.remediation) + '</div>';
        } else {
            html += '<div style="color:#555">Run the pipeline to estimate this edge, or check that required data is available for both endpoints.</div>';
        }
        html += '</div>';
    }
    if (d.strategy_type) html += '<div class="tooltip-row"><span class="tooltip-label">ID Strategy</span><span class="tooltip-value">' + d.strategy_type.replace(/_/g, ' ') + '</span></div>';
    if (d.strategy_argument) html += '<div class="tooltip-row"><span class="tooltip-label">Argument</span><span class="tooltip-value" style="text-align:left;font-weight:400;font-size:10px">' + d.strategy_argument + '</span></div>';
    if (d.provenance_source) {
        var srcLabel = PROVENANCE_LABELS[d.provenance_source] || d.provenance_source;
        var srcExtra = d.provenance_detail ? ' (' + escHtml(d.provenance_detail) + ')' : '';
        html += '<div class="tooltip-row"><span class="tooltip-label">Source</span><span class="tooltip-value">' + escHtml(srcLabel) + srcExtra + '</span></div>';
    }
    if (d.diagnostics && d.diagnostics.length > 0) {
        var passed = d.diagnostics.filter(function(x) { return x.passed; }).length;
        html += '<div class="tooltip-row"><span class="tooltip-label">Diagnostics</span><span class="tooltip-value">' + passed + '/' + d.diagnostics.length + ' pass</span></div>';
    }
    if (d.interpretation) html += '<div class="tooltip-row"><span class="tooltip-label">Interpretation</span><span class="tooltip-value" style="text-align:left;font-weight:400">' + d.interpretation + '</span></div>';
    if (d.llm_annotation) {
        html += '<div class="tooltip-annotation">' + d.llm_annotation + '</div>';
    }
    if (d.issues && d.issues.length > 0) {
        html += '<div class="tooltip-issues">';
        d.issues.forEach(function(issue) {
            html += '<div class="tooltip-issue ' + (issue.severity || '').toLowerCase() + '">[' + issue.severity + '] ' + escHtml(issue.message) + '</div>';
        });
        html += '</div>';
    }
    tooltip.html(html).style('left', (e.pageX + 15) + 'px').style('top', (e.pageY - 15) + 'px').classed('visible', true);
}

function renderOrphanSections(s) {
    if (!s) return '';
    // Match **Role**, **Blocker**, **Blocker (TYPE)**, **Path forward**
    var sections = [
        {key: 'role', re: /\*\*Role\*\*:\s*/i},
        {key: 'blocker', re: /\*\*Blocker(?:\s*\([^)]*\))?\*\*:\s*/i},
        {key: 'path-forward', re: /\*\*Path\s+forward\*\*:\s*/i}
    ];
    var indices = [];
    sections.forEach(function(sec) {
        var m = s.match(sec.re);
        if (m) {
            // Extract label from matched text (e.g. "Blocker (DATA)")
            var raw = m[0].replace(/\*\*/g, '').replace(/:\s*$/, '').trim();
            indices.push({key: sec.key, idx: s.indexOf(m[0]), len: m[0].length, label: raw});
        }
    });
    indices.sort(function(a, b) { return a.idx - b.idx; });
    if (indices.length === 0) return '<div style="font-size:10px;color:#555">' + escHtml(s) + '</div>';
    var html = '';
    for (var i = 0; i < indices.length; i++) {
        var start = indices[i].idx + indices[i].len;
        var end = (i + 1 < indices.length) ? indices[i + 1].idx : s.length;
        var body = s.substring(start, end).trim();
        html += '<div class="tooltip-orphan-section ' + indices[i].key + '">' +
            '<div class="tooltip-orphan-label">' + escHtml(indices[i].label) + '</div>' +
            '<div style="font-size:10px">' + escHtml(body) + '</div></div>';
    }
    return html;
}

function extractVerdict(s) {
    if (!s) return '';
    var m = s.match(/\*\*Verdict\*\*:\s*(STRONG|MODERATE|WEAK|ABSENT)/i);
    return m ? m[1].toUpperCase() : '';
}

function renderCausalAssessment(s) {
    if (!s) return '';
    var sections = [
        {key: 'finding', re: /\*\*Strategy\*\*:\s*/i, label: 'Strategy'},
        {key: 'concern', re: /\*\*Strengths\*\*:\s*/i, label: 'Strengths'},
        {key: 'recommendation', re: /\*\*Vulnerabilities\*\*:\s*/i, label: 'Vulnerabilities'},
        {key: 'finding', re: /\*\*Verdict\*\*:\s*/i, label: 'Verdict'}
    ];
    var indices = [];
    sections.forEach(function(sec) {
        var m = s.match(sec.re);
        if (m) indices.push({key: sec.key, idx: s.indexOf(m[0]), len: m[0].length, label: sec.label});
    });
    indices.sort(function(a, b) { return a.idx - b.idx; });
    if (indices.length === 0) return renderMarkdown(s);
    var html = '';
    for (var i = 0; i < indices.length; i++) {
        var start = indices[i].idx + indices[i].len;
        var end = (i + 1 < indices.length) ? indices[i + 1].idx : s.length;
        var body = s.substring(start, end).trim();
        var cls = indices[i].key;
        if (indices[i].label === 'Strengths') cls = 'recommendation';
        if (indices[i].label === 'Vulnerabilities') cls = 'concern';
        html += '<div class="pd-section ' + cls + '">' +
            '<div class="pd-section-label">' + escHtml(indices[i].label) + '</div>' +
            renderMarkdown(body) + '</div>';
    }
    return html;
}

function showNodeTooltip(e, d) {
    var html = '<h3>' + d.label + '</h3>';
    html += '<div class="tooltip-row"><span class="tooltip-label">ID</span><span class="tooltip-value">' + d.id + '</span></div>';
    if (d.description) html += '<div class="tooltip-row"><span class="tooltip-label">Description</span><span class="tooltip-value" style="text-align:left;font-weight:400">' + d.description + '</span></div>';
    if (d.unit) html += '<div class="tooltip-row"><span class="tooltip-label">Unit</span><span class="tooltip-value">' + d.unit + '</span></div>';
    if (d.frequency) html += '<div class="tooltip-row"><span class="tooltip-label">Frequency</span><span class="tooltip-value">' + d.frequency + '</span></div>';
    if (d.latent) html += '<div class="tooltip-row"><span class="tooltip-label">Observed</span><span class="tooltip-value null">Latent (unobserved)</span></div>';
    if (d.provenance_source) {
        var nodeSrcLabel = PROVENANCE_LABELS[d.provenance_source] || d.provenance_source;
        html += '<div class="tooltip-row"><span class="tooltip-label">Source</span><span class="tooltip-value">' + escHtml(nodeSrcLabel) + '</span></div>';
    }
    if (d.orphan) {
        var orphanText = ORPHAN_EXPLANATIONS[d.id] || '';
        html += '<div class="tooltip-orphan">';
        html += '<span class="tooltip-orphan-tag">UNWIRED</span>';
        if (d.provenance_source) html += provenanceBadge(d.provenance_source);
        if (orphanText) {
            html += renderOrphanSections(orphanText);
        } else {
            html += '<div style="font-size:10px;color:#999;font-style:italic">No edges connect this node. Run with --llm-annotate for analysis.</div>';
        }
        html += '</div>';
    }
    tooltip.html(html).style('left', (e.pageX + 15) + 'px').style('top', (e.pageY - 15) + 'px').classed('visible', true);
}

function hideTooltip() { tooltip.classed('visible', false); }

function getLabelPos(d) {
    var dx = d.target.x - d.source.x;
    var dy = d.target.y - d.source.y;
    var dist = Math.sqrt(dx*dx + dy*dy) || 1;
    var t = 0.4;
    var mx = d.source.x + dx * t;
    var my = d.source.y + dy * t;
    var offset = 12;
    var px = -dy / dist * offset;
    var py = dx / dist * offset;
    return { x: mx + px, y: my + py };
}

simulation.on('tick', function() {
    links.attr('d', function(d) {
        var dx = d.target.x - d.source.x, dy = d.target.y - d.source.y;
        var dr = Math.sqrt(dx * dx + dy * dy) * 1.8;
        return 'M' + d.source.x + ',' + d.source.y + 'A' + dr + ',' + dr + ' 0 0,1 ' + d.target.x + ',' + d.target.y;
    });
    linkLabels.each(function(d) {
        var pos = getLabelPos(d);
        d3.select(this).attr('x', pos.x).attr('y', pos.y);
    });
    labelBgs.each(function(d, i) {
        var pos = getLabelPos(d);
        var textNode = linkLabels.nodes()[i];
        var bbox = textNode.getBBox();
        d3.select(this)
            .attr('x', pos.x - bbox.width/2 - 2)
            .attr('y', pos.y - bbox.height/2 - 1)
            .attr('width', bbox.width + 4)
            .attr('height', bbox.height + 2);
    });
    node.attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; });
});

// ── Filters ──────────────────────────────────────────────────────────────
function applyFilters() {
    var typeVal = document.getElementById('typeFilter').value;
    var ratVal = document.getElementById('ratingFilter').value;
    var showNullVal = document.getElementById('showNull').checked;
    var showLabelsVal = document.getElementById('showLabels').checked;

    var isVisible = function(d) {
        if (typeVal !== 'all' && d.edge_type !== typeVal) return false;
        if (ratVal !== 'all' && d.rating !== ratVal) return false;
        if (!showNullVal && isEdgeNull(d)) return false;
        return true;
    };

    links.style('display', function(d) { return isVisible(d) ? null : 'none'; });
    linkLabels.style('display', function(d) { return (isVisible(d) && showLabelsVal) ? null : 'none'; });
    labelBgs.style('display', function(d) { return (isVisible(d) && showLabelsVal) ? null : 'none'; });

    var visible = EDGES.filter(isVisible);
    document.getElementById('statEdges').textContent = visible.length;
    document.getElementById('statA').textContent = visible.filter(function(e) { return e.rating === 'A'; }).length;
    document.getElementById('statB').textContent = visible.filter(function(e) { return e.rating === 'B'; }).length;
    document.getElementById('statC').textContent = visible.filter(function(e) { return e.rating === 'C'; }).length;
    var visibleIssues = visible.reduce(function(s, e) { return s + (e.issues ? e.issues.length : 0); }, 0);
    document.getElementById('statIssues').textContent = visibleIssues;
    var identified = visible.filter(function(e) { return e.claim_level === 'IDENTIFIED_CAUSAL'; }).length;
    document.getElementById('statIdentified').textContent = identified;
    var blocked = visible.filter(function(e) { return e.blocked_reason; }).length;
    var nodata = visible.filter(function(e) { return e.design === 'DATA_INSUFFICIENT'; }).length;
    document.getElementById('statBlocked').textContent = blocked + (nodata ? ' + ' + nodata + ' no data' : '');
}

document.getElementById('typeFilter').addEventListener('change', applyFilters);
document.getElementById('ratingFilter').addEventListener('change', applyFilters);
document.getElementById('showNull').addEventListener('change', applyFilters);
document.getElementById('showLabels').addEventListener('change', applyFilters);

applyFilters();
    </script>
</body>
</html>