# Design registry v1 for estimator selection.
# Maps identification strategies to templates, diagnostics, and data requirements.

schema_version: 1
registry_name: "default_designs"

# Global defaults applied when a design does not override.
_defaults:
  standard_errors: "cluster"  # cluster, driscoll_kraay, hac
  missing_rate_max: 0.10
  min_obs: 30

# Each design is referenced by id in DAG edge specs.
designs:
  - id: "PANEL_FE_BACKDOOR"
    name: "Panel FE Backdoor"
    description: "Fixed effects panel regression using a backdoor adjustment set."
    requirements:
      data:
        panel: true
        min_periods: 8
        min_units: 10
      variables:
        treatment_type: ["continuous", "binary"]
        outcome_type: ["continuous", "share", "index"]
    template:
      model: "y_it = beta * x_it + gamma' * controls_it + alpha_i + tau_t + e_it"
      fixed_effects: ["unit", "time"]
      standard_errors: "cluster(unit)"
    diagnostics:
      required: ["residual_checks", "influence" ]
      optional: ["placebo_exposure", "pre_trends"]
    outputs:
      edge_card_fields: ["beta", "se", "ci", "fixed_effects", "controls"]

  - id: "DID_EVENT_STUDY"
    name: "Difference-in-Differences Event Study"
    description: "TWFE event study with pre-trend checks."
    requirements:
      data:
        panel: true
        min_periods: 12
      variables:
        treatment_type: ["binary"]
        outcome_type: ["continuous", "share", "index"]
    template:
      model: "y_it = sum_k beta_k * 1[t = k] * treated_i + alpha_i + tau_t + e_it"
      standard_errors: "cluster(unit)"
    diagnostics:
      required: ["pre_trends", "placebo_event"]
      optional: ["balanced_panel"]
    outputs:
      edge_card_fields: ["event_time_betas", "pretrend_p", "ci_bands"]

  - id: "IV_2SLS"
    name: "Instrumental Variables 2SLS"
    description: "Two-stage least squares with explicit exclusion restriction notes."
    requirements:
      data:
        min_obs: 50
      variables:
        treatment_type: ["continuous"]
        outcome_type: ["continuous", "share", "index"]
        instrument_count_min: 1
    template:
      model: "x_it = pi * z_it + controls_it + u_it; y_it = beta * xhat_it + controls_it + v_it"
      standard_errors: "robust"
    diagnostics:
      required: ["weak_iv", "first_stage_f", "exclusion_narrative"]
      optional: ["overid"]
    outputs:
      edge_card_fields: ["beta", "se", "first_stage_f", "overid_p"]

  - id: "LOCAL_PROJECTIONS"
    name: "Local Projections IRF"
    description: "Jorda local projections for dynamic impulse responses."
    requirements:
      data:
        time_series: true
        min_periods: 20
      variables:
        treatment_type: ["continuous"]
        outcome_type: ["continuous", "share", "index"]
    template:
      model: "y_{t+h} = beta_h * shock_t + controls_t + e_{t+h}"
      horizon_max: 12
      standard_errors: "hac"
    diagnostics:
      required: ["stability", "lag_sensitivity"]
      optional: ["structural_breaks"]
    outputs:
      edge_card_fields: ["irf", "ci_bands", "horizon"]

  - id: "RDD"
    name: "Regression Discontinuity"
    description: "Local linear RD with density and bandwidth checks."
    requirements:
      data:
        running_variable: true
        min_obs: 200
      variables:
        treatment_type: ["binary"]
        outcome_type: ["continuous", "share", "index"]
    template:
      model: "y = beta * 1[x >= c] + f(x) + e"
      standard_errors: "robust"
    diagnostics:
      required: ["density", "bandwidth_sensitivity"]
      optional: ["covariate_balance"]
    outputs:
      edge_card_fields: ["beta", "se", "bandwidth"]
